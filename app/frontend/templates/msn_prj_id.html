{% extends 'master_page.html' %}

{% block page_title %}
    <title>{{ prj.name }}</title>
{% endblock %}

{% block bl_user_name %}

    {% include 'user_bar.html' %}

{% endblock %}

{% block sidebar_MSN_prj %}
    <a href="\msn-prj" class="nav-item nav-link active"><i class="fa fa-tachometer-alt me-2"></i>MSN projects</a>
{% endblock %}

{% block content %}
    <div class="container-fluid pt-4 px-4">

            {% if strErr|trim|length %}
                <div id="err" class="alert alert-danger" role="alert">
                    {{ strErr }}
                </div>
            {% endif %}

            <div class="bg-light text-center rounded p-4">
                <div class="d-flex align-items-center justify-content-between mb-0">
                    <h3 class="mb-0">{{ prj.internal_id }} - {{ prj.name }}</h3>

                    <div>
                        <h7 class="mb-0">{{ prj.categorical }}</h7><br/>
                        <h7 class="mb-0">{{ prj.status }}</h7>
                    </div>

                </div>

            </div>

        </div>


    <div class="container-fluid pt-4 px-4">

        <div class="bg-light rounded h-100 p-4">

            <nav>
                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                    <button class="nav-link active" id="nav-info-tab" data-bs-toggle="tab"
                        data-bs-target="#nav-info" type="button" role="tab" aria-controls="nav-info"
                        aria-selected="true">Information</button>

                    <button class="nav-link" id="nav-sections-tab" data-bs-toggle="tab"
                        data-bs-target="#nav-sections" type="button" role="tab" aria-controls="nav-sections"
                        aria-selected="false">Sections</button>

                    <button class="nav-link" id="nav-oe_combine-tab" data-bs-toggle="tab"
                        data-bs-target="#nav-oe_combine" type="button" role="tab" aria-controls="nav-oe_combine"
                        aria-selected="false">OE combine</button>

                    <button class="nav-link" id="nav-scr-tab" data-bs-toggle="tab"
                        data-bs-target="#nav-scr" type="button" role="tab" aria-controls="nav-scr"
                        aria-selected="false">Screener</button>

                    <button class="nav-link" id="nav-pro-tab" data-bs-toggle="tab"
                        data-bs-target="#nav-pro" type="button" role="tab" aria-controls="nav-pro"
                        aria-selected="false">Product</button>

                    <button class="nav-link" id="nav-fc-tab" data-bs-toggle="tab"
                        data-bs-target="#nav-fc" type="button" role="tab" aria-controls="nav-fc"
                        aria-selected="false">Force choice</button>

                    <button class="nav-link" id="nav-add_vars-tab" data-bs-toggle="tab"
                        data-bs-target="#nav-add_vars" type="button" role="tab" aria-controls="nav-add_vars"
                        aria-selected="false">Addin variables</button>

                    <button class="nav-link" id="nav-topline-tab" data-bs-toggle="tab"
                        data-bs-target="#nav-topline" type="button" role="tab" aria-controls="nav-topline"
                        aria-selected="false">Topline design</button>

                    <button class="nav-link" id="nav-data-tab" data-bs-toggle="tab"
                        data-bs-target="#nav-data" type="button" role="tab" aria-controls="nav-data"
                        aria-selected="false">Data</button>

                </div>
            </nav>



            <div class="tab-content pt-3" id="nav-tabContent">


                <div class="tab-pane fade show active" id="nav-info" role="tabpanel" aria-labelledby="nav-info-tab">
<!--                    this is information-->
                    <form id="form_info" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">
                        <input type="hidden" id='output_info' name="output">

                        <div class="row g-0">
                            <div class="col-sm-12 col-xl-6">
                                <div class="bg-light rounded h-100 p-4">
                                    <div class="form-floating mb-0">
                                        <input type="text" class="form-control" id="internal_id"
                                               name="internal_id" value="{{ prj.internal_id }}" placeholder="">
                                        <label for="internal_id">Internal ID</label>
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-12 col-xl-6">
                                <div class="bg-light rounded h-100 p-4">
                                    <div class="form-floating mb-0">
                                        <input type="text" class="form-control" id="prj_name"
                                               name="name" value="{{ prj.name }}" placeholder="">
                                        <label for="prj_name">Name</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row g-0">
                            <div class="col-sm-12 col-xl-6">
                                <div class="bg-light rounded h-100 p-4">
                                    <div class="form-floating mb-0">
                                        <input type="text" class="form-control" id="prj_cat"
                                               name="categorical" value="{{ prj.categorical }}" placeholder="">
                                        <label for="prj_cat">Category</label>
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-12 col-xl-6">
                                <div class="bg-light rounded h-100 p-4">
                                    <div class="form-floating mb-0">

                                        <select class="form-select" id="floatingSelect_status"
                                            aria-label="Floating label select example"
                                            name="status">

                                            {% for stt in ['Completed', 'On Going', 'Pending', 'Cancel'] %}

                                                {% if prj.status == stt %}
                                                    <option selected value="{{ stt }}">{{ stt }}</option>
                                                {% else %}
                                                    <option value="{{ stt }}">{{ stt }}</option>
                                                {% endif %}

                                            {% endfor %}

                                        </select>
                                        <label for="floatingSelect_status">Status</label>
                                    </div>

                                </div>
                            </div>
                        </div>


                        <div class="bg-light rounded h-100 p-4">
                            <div class="d-flex align-items-center justify-content-end mb-4">
                                <input class="btn btn-primary py-3 w-25" type="submit" value="Submit info" onclick="fnc_submit('info', false)">
                            </div>
                        </div>
                    </form>

                </div>

                <div class="tab-pane fade" id="nav-sections" role="tabpanel" aria-labelledby="nav-sections-tab">

<!--                    This is sections-->

                    <form id="form_sections" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">

                        <input type="hidden" id='output_sections' name="output">

                        <div class="bg-light rounded h-100 p-4">

                            <div class="form-floating mb-0">
                                <input type="text" class="form-control" id="join_col" name="detail.join_col" value="{{ prj.detail.join_col }}" placeholder="">
                                <label for="join_col">RID column</label>
                            </div>

                        </div>

                        {% for key, val in prj.detail.sections.items() %}

                            <div class="bg-light rounded h-100 p-4">
                                <h4 class="mb-0">Section {{ key }}</h4>

                                <div class="row g-0">

                                    <div class="col-sm-12 col-xl-6">
                                        <div class="bg-light rounded h-100 p-4">
                                            <div class="form-floating mb-0">
                                                <input type="text" class="form-control" id="detail.sections.{{ key }}.name"
                                                       name="detail.sections.{{ key }}.name" value="{{ val.name }}" placeholder="">
                                                <label for="detail.sections.{{ key }}.name">Name</label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-12 col-xl-6">
                                        <div class="bg-light rounded h-100 p-4">
                                            <div class="form-floating mb-0">
                                                <input type="text" class="form-control" id="detail.sections.{{ key }}.filter"
                                                       name="detail.sections.{{ key }}.filter" value="{{ val.filter }}" placeholder="">
                                                <label for="detail.sections.{{ key }}.filter">Filter</label>
                                            </div>
                                        </div>
                                    </div>


                                    {% for k_p, v_p in val.product_qres.items() %}
                                        <div class="col-sm-12 col-xl-6">
                                            <div class="bg-light rounded h-100 p-4">
                                                <h6 class="mb-3">Product {{ k_p }}</h6>

                                                    <div class="form-floating mb-2">
                                                        <input type="text" class="form-control" id="detail.sections.{{ key }}.product_qres.{{ k_p }}.name"
                                                               name="detail.sections.{{ key }}.product_qres.{{ k_p }}.name" value="{{ v_p.name }}" placeholder="">
                                                        <label for="detail.sections.{{ key }}.product_qres.{{ k_p }}.name">Name</label>
                                                    </div>

                                                    <div class="form-floating mb-2">
                                                        <input type="text" class="form-control" id="detail.sections.{{ key }}.product_qres.{{ k_p }}.lbl"
                                                               name="detail.sections.{{ key }}.product_qres.{{ k_p }}.lbl" value="{{ v_p.lbl }}" placeholder="">
                                                        <label for="detail.sections.{{ key }}.product_qres.{{ k_p }}.lbl">Label</label>
                                                    </div>

                                                    <div class="form-floating mb-2">
                                                        <input type="text" class="form-control" id="detail.sections.{{ key }}.product_qres.{{ k_p }}.qres.0"
                                                               name="detail.sections.{{ key }}.product_qres.{{ k_p }}.qres.0" value="{{ v_p.qres[0] }}" placeholder="">
                                                        <label for="detail.sections.{{ key }}.product_qres.{{ k_p }}.qres.0">Get data from</label>
                                                    </div>

                                                    {% for k_cat, v_cat in v_p.cats.items() %}

                                                        <div class="input-group mb-1">
                                                            <span class="input-group-text">Value</span>

                                                            <input type="text" class="form-control" id="detail.sections.{{ key }}.product_qres.{{ k_p }}.cats.{{ k_cat }}.val"
                                                                   name="detail.sections.{{ key }}.product_qres.{{ k_p }}.cats.{{ k_cat }}.val"
                                                                   value="{{ v_cat.val }}" placeholder="" aria-label="">

                                                            <span class="input-group-text">Label</span>

                                                            <input type="text" class="form-control" id="detail.sections.{{ key }}.product_qres.{{ k_p }}.cats.{{ k_cat }}.lbl"
                                                                   name="detail.sections.{{ key }}.product_qres.{{ k_p }}.cats.{{ k_cat }}.lbl"
                                                                   value="{{ v_cat.lbl }}" placeholder="" aria-label="">
                                                        </div>

                                                    {% endfor %}


                                            </div>

                                        </div>

                                    {% endfor %}

                                    <div class="bg-light rounded h-100 p-4 mb-0">
                                        <div class="form-floating mb-0">
                                            <input type="text" class="form-control" id="detail.sections.{{ key }}.fc_qres.0"
                                                   name="detail.sections.{{ key }}.fc_qres.0"
                                                   value="{{ val.fc_qres[0] }}" placeholder="">
                                            <label for="detail.sections.{{ key }}.fc_qres.0">Force choice question</label>
                                        </div>
                                    </div>


                                </div>

                            </div>

                        {% endfor %}

                        <div class="bg-light rounded h-100 p-4">
                            <div class="d-flex align-items-center justify-content-end mb-4">
                                <input class="btn btn-primary py-3 w-25" type="submit" value="Submit sections" onclick="fnc_submit('sections', false)">
                            </div>
                        </div>

                    </form>

                </div>

                <div class="tab-pane fade" id="nav-oe_combine" role="tabpanel" aria-labelledby="nav-oe_combine-tab">
<!--                        this is oe combine-->

                    <dialog id="dialog_bulkup_oe_combine" class="col-sm-12 col-xl-6">

                        <div class="bg-light rounded h-100 p-4">

                            <div class="d-flex align-items-center justify-content-between mb-2">
                                <h5 class="mb-2">Bulk-up OE Combine</h5>
                            </div>

                            <form id="form_bulkup_oe_combine" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">

                                <input type="hidden" id='output_bulkup_oe_combine' name="output">

                                <div class="align-items-center justify-content-between mb-2">

                                    <div class="form-floating">
                                        <textarea class="form-control" placeholder="Leave a input here"
                                            id="floatingTextarea_oe_combine" name="detail.oe_combine_cols" style="height: 500px"></textarea>
                                        <label for="floatingTextarea_oe_combine">Leave an input here</label>
                                    </div>

                                </div>

                                <div class="d-flex align-items-center justify-content-end mb-2">
                                    <button type="button" class="btn btn-secondary py-3 w-25" onclick="closeDialog('dialog_bulkup_oe_combine')">Close</button>
                                    <input class="btn btn-primary py-3 w-25" type="submit" value="Submit" id="submit_bulkup_oe_combine" onclick="fnc_submit('bulkup_oe_combine', true)">
                                </div>

                            </form>

                        </div>

                    </dialog>


                    <form id="form_oe_combine" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">

                        <input type="hidden" id='output_oe_combine' name="output">

                        <div class="bg-light rounded h-100 p-4">
                            <div class="row g-1">

                                {% if prj.detail.oe_combine_cols %}

                                    {% for key, val in prj.detail.oe_combine_cols.items() %}

                                        <div id="detail.oe_combine_cols.{{ key }}" class="input-group mb-1">
                                            <span class="input-group-text">{{ key }}</span>

                                            <input type="text" class="form-control" id="detail.oe_combine_cols.{{ key }}.0"
                                                   name="detail.oe_combine_cols.{{ key }}.0" value="{{ val[0] }}" placeholder="" aria-label="">

                                            <span class="input-group-text">=</span>

                                            <input type="text" class="form-control" id="detail.oe_combine_cols.{{ key }}.1"
                                                   name="detail.oe_combine_cols.{{ key }}.1" value="{{ val[1] }}" placeholder="" aria-label="">

                                            <span class="input-group-text">+</span>

                                            <input type="text" class="form-control" id="detail.oe_combine_cols.{{ key }}.2"
                                                   name="detail.oe_combine_cols.{{ key }}.2" value="{{ val[2] }}" placeholder="" aria-label="">

                                            <input type="button" class="btn btn-outline-danger" value="X"
                                                   onclick="Del_Row('detail.oe_combine_cols.{{ key }}', '{{ key }} - {{ val[0] }}');">

                                        </div>

                                    {% endfor %}

                                {% else %}

                                    <div class="d-flex align-items-center justify-content-center mb-2">
                                        <h6 class="mb-2">Bulk it up</h6>
                                    </div>

                                {% endif %}

                            </div>
                        </div>

                        <div class="bg-light rounded h-100 p-4">
                            <div class="d-flex align-items-center justify-content-between mb-0">
                                <button type="button" class="btn btn-outline-primary py-3 w-25" onclick="showDialog('dialog_bulkup_oe_combine')">Bulk-up</button>
                                <input class="btn btn-primary py-3 w-25 mb-0" type="submit" id="submit_oe_combine" value="Submit OE combine" onclick="fnc_submit('oe_combine', false)">
                            </div>
                        </div>

                    </form>

                </div>

                <div class="tab-pane fade" id="nav-scr" role="tabpanel" aria-labelledby="nav-scr-tab">
<!--                    this is screener-->

                    <dialog id="dialog_bulkup_scr_cols" class="col-sm-12 col-xl-6">

                        <div class="bg-light rounded h-100 p-4">

                            <div class="d-flex align-items-center justify-content-between mb-2">
                                <h5 class="mb-2">Bulk-up screener columns</h5>
                            </div>

                            <form id="form_bulkup_scr_cols" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">

                                <input type="hidden" id='output_bulkup_scr_cols' name="output">

                                <div class="align-items-center justify-content-between mb-2">

                                    <div class="form-floating">
                                        <textarea class="form-control" placeholder="Leave a input here"
                                            id="floatingTextarea_scr_cols" name="detail.scr_cols" style="height: 500px"></textarea>
                                        <label for="floatingTextarea_scr_cols">Leave an input here</label>
                                    </div>

                                </div>

                                <div class="d-flex align-items-center justify-content-end mb-2">
                                    <button type="button" class="btn btn-secondary py-3 w-25" onclick="closeDialog('dialog_bulkup_scr_cols')">Close</button>
                                    <input class="btn btn-primary py-3 w-25" type="submit" value="Submit" id="submit_bulkup_scr_cols" onclick="fnc_submit('bulkup_scr_cols', true)">
                                </div>

                            </form>

                        </div>

                    </dialog>


                    <form id="form_scr_cols" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">

                        <input type="hidden" id='output_scr_cols' name="output">

                        <div class="bg-light rounded h-100 p-4">

                            <div class="table-responsive">
                                <table class="table text-start align-middle table-bordered table-hover mb-0">
                                    <thead>
                                        <tr class="text-dark">
                                            <th width="5%" scope="col">#</th>
                                            <th scope="col">Output data column name</th>
                                            <th scope="col">Rawdata column name</th>
                                            <th width="5%" scope="col"></th>
                                        </tr>
                                    </thead>
                                    <tbody>

                                        {% if prj.detail.scr_cols %}

                                            {% for key, val in prj.detail.scr_cols.items() %}

                                                <tr id="detail.scr_cols.{{ key }}">
                                                    <td width="5%">{{ key }}</td>
                                                    <td><input type="text" class="form-control" id="detail.scr_cols.{{ key }}.0"
                                                           name="detail.scr_cols.{{ key }}.0" value="{{ val[0] }}" placeholder="" aria-label=""></td>
                                                    <td><input type="text" class="form-control" id="detail.scr_cols.{{ key }}.1"
                                                           name="detail.scr_cols.{{ key }}.1" value="{{ val[1] }}" placeholder="" aria-label=""></td>

                                                    <td width="5%"><input type="button" class="btn btn-outline-danger" value="X"
                                                               onclick="Del_Row('detail.scr_cols.{{ key }}', '{{ key }} - {{ val[0] }}');"></td>
                                                </tr>

                                            {% endfor %}

                                        {% else %}

                                            <tr>
                                                <td>=></td>
                                                <td>Bulk it up</td>
                                                <td><=</td>
                                            </tr>

                                        {% endif %}

                                    </tbody>
                                </table>
                            </div>

                        </div>


                        <div class="bg-light rounded h-100 p-4">
                            <div class="d-flex align-items-center justify-content-between mb-0">
                                <button type="button" class="btn btn-outline-primary py-3 w-25" onclick="showDialog('dialog_bulkup_scr_cols')">Bulk-up</button>
                                <input class="btn btn-primary py-3 w-25" type="submit" id="submit_scr_cols" value="Submit screener" onclick="fnc_submit('scr_cols', false)">
                            </div>
                        </div>

                    </form>

                </div>

                <div class="tab-pane fade" id="nav-pro" role="tabpanel" aria-labelledby="nav-pro-tab">
<!--                    this is product-->

                    <dialog id="dialog_bulkup_product_cols" class="col-sm-12 col-xl-6">

                        <div class="bg-light rounded h-100 p-4">

                            <div class="d-flex align-items-center justify-content-between mb-2">
                                <h5 class="mb-2">Bulk-up product columns</h5>
                            </div>

                            <form id="form_bulkup_product_cols" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">

                                <input type="hidden" id='output_bulkup_product_cols' name="output">

                                <div class="align-items-center justify-content-between mb-2">

                                    <div class="form-floating">
                                        <textarea class="form-control" placeholder="Leave a input here"
                                            id="floatingTextarea_product_cols" name="detail.product_cols" style="height: 500px"></textarea>
                                        <label for="floatingTextarea_product_cols">Leave an input here</label>
                                    </div>

                                </div>

                                <div class="d-flex align-items-center justify-content-end mb-2">
                                    <button type="button" class="btn btn-secondary py-3 w-25" onclick="closeDialog('dialog_bulkup_product_cols')">Close</button>
                                    <input class="btn btn-primary py-3 w-25" type="submit" value="Submit" id="submit_bulkup_product_cols" onclick="fnc_submit('bulkup_product_cols', true)">
                                </div>

                            </form>

                        </div>

                    </dialog>


                    <form id="form_product_cols" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">

                        <input type="hidden" id='output_product_cols' name="output">

                        <div class="bg-light rounded h-100 p-4">

                            <div class="table-responsive">
                                <table class="table text-start align-middle table-bordered table-hover mb-0">
                                    <thead>
                                        <tr class="text-dark">
                                            <th width="5%" scope="col">#</th>
                                            <th scope="col">Output data column name</th>
                                            <th scope="col">Rawdata 1st product col name</th>
                                            <th scope="col">Rawdata 2nd product col name</th>
                                            <th width="5%" scope="col"></th>
                                        </tr>
                                    </thead>
                                    <tbody>

                                        {% if prj.detail.product_cols %}

                                            {% for key, val in prj.detail.product_cols.items() %}

                                                <tr id="detail.product_cols.{{ key }}">
                                                    <td width="5%">{{ key }}</td>
                                                    <td><input type="text" class="form-control" id="detail.product_cols.{{ key }}.0"
                                                           name="detail.product_cols.{{ key }}.0" value="{{ val[0] }}" placeholder="" aria-label=""></td>
                                                    <td><input type="text" class="form-control" id="detail.product_cols.{{ key }}.1"
                                                           name="detail.product_cols.{{ key }}.1" value="{{ val[1] }}" placeholder="" aria-label=""></td>
                                                    <td><input type="text" class="form-control" id="detail.product_cols.{{ key }}.2"
                                                           name="detail.product_cols.{{ key }}.2" value="{{ val[2] }}" placeholder="" aria-label=""></td>
                                                    <td width="5%"><input type="button" class="btn btn-outline-danger" value="X"
                                                                          onclick="Del_Row('detail.product_cols.{{ key }}', '{{ key }} - {{ val[0] }}');"></td>
                                                </tr>

                                            {% endfor %}

                                        {% else %}

                                            <tr>
                                                <td></td>
                                                <td>=></td>
                                                <td>Bulk it up</td>
                                                <td><=</td>
                                            </tr>

                                        {% endif %}

                                    </tbody>
                                </table>
                            </div>

                        </div>

                        <div class="bg-light rounded h-100 p-4">
                            <div class="d-flex align-items-center justify-content-between mb-0">
                                <button type="button" class="btn btn-outline-primary py-3 w-25" onclick="showDialog('dialog_bulkup_product_cols')">Bulk-up</button>
                                <input class="btn btn-primary py-3 w-25" type="submit" id="submit_product_cols" value="Submit product" onclick="fnc_submit('product_cols', false)">
                            </div>
                        </div>

                    </form>


                </div>

                <div class="tab-pane fade" id="nav-fc" role="tabpanel" aria-labelledby="nav-fc-tab">
<!--                    this is force choice-->

                    <dialog id="dialog_bulkup_fc_cols" class="col-sm-12 col-xl-6">

                        <div class="bg-light rounded h-100 p-4">

                            <div class="d-flex align-items-center justify-content-between mb-2">
                                <h5 class="mb-2">Bulk-up force choice columns</h5>
                            </div>

                            <form id="form_bulkup_fc_cols" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">

                                <input type="hidden" id='output_bulkup_fc_cols' name="output">

                                <div class="align-items-center justify-content-between mb-2">

                                    <div class="form-floating">
                                        <textarea class="form-control" placeholder="Leave a input here"
                                            id="floatingTextarea_fc_cols" name="detail.fc_cols" style="height: 500px"></textarea>
                                        <label for="floatingTextarea_fc_cols">Leave an input here</label>
                                    </div>

                                </div>

                                <div class="d-flex align-items-center justify-content-end mb-2">
                                    <button type="button" class="btn btn-secondary py-3 w-25" onclick="closeDialog('dialog_bulkup_fc_cols')">Close</button>
                                    <input class="btn btn-primary py-3 w-25" type="submit" value="Submit" id="submit_bulkup_fc_cols" onclick="fnc_submit('bulkup_fc_cols', true)">
                                </div>

                            </form>

                        </div>

                    </dialog>


                    <form id="form_fc_cols" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">

                        <input type="hidden" id='output_fc_cols' name="output">

                        <div class="bg-light rounded h-100 p-4">

                            <div class="table-responsive">
                                <table class="table text-start align-middle table-bordered table-hover mb-0">
                                    <thead>
                                        <tr class="text-dark">
                                            <th width="5%" scope="col">#</th>
                                            <th scope="col">Output data column name</th>
                                            <th scope="col">Rawdata column name</th>
                                            <th width="5%" scope="col"></th>
                                        </tr>
                                    </thead>
                                    <tbody>

                                        {% if prj.detail.fc_cols %}

                                            {% for key, val in prj.detail.fc_cols.items() %}

                                                <tr id="detail.fc_cols.{{ key }}">
                                                    <td width="5%">{{ key }}</td>
                                                    <td><input type="text" class="form-control" id="detail.fc_cols.{{ key }}.0"
                                                           name="detail.fc_cols.{{ key }}.0" value="{{ val[0] }}" placeholder="" aria-label=""></td>
                                                    <td><input type="text" class="form-control" id="detail.fc_cols.{{ key }}.1"
                                                           name="detail.fc_cols.{{ key }}.1" value="{{ val[1] }}" placeholder="" aria-label=""></td>
                                                    <td width="5%"><input type="button" class="btn btn-outline-danger" value="X"
                                                                          onclick="Del_Row('detail.fc_cols.{{ key }}', '{{ key }} - {{ val[0] }}');"></td>
                                                </tr>

                                            {% endfor %}

                                        {% else %}

                                            <tr>
                                                <td>=></td>
                                                <td>Bulk it up</td>
                                                <td><=</td>
                                            </tr>

                                        {% endif %}

                                    </tbody>
                                </table>
                            </div>

                        </div>

                        <div class="bg-light rounded h-100 p-4">
                            <div class="d-flex align-items-center justify-content-between mb-0">
                                <button type="button" class="btn btn-outline-primary py-3 w-25" onclick="showDialog('dialog_bulkup_fc_cols')">Bulk-up</button>
                                <input class="btn btn-primary py-3 w-25" type="submit" id="submit_fc_cols" value="Submit force choice" onclick="fnc_submit('fc_cols', false)">
                            </div>
                        </div>

                    </form>


                </div>

                <div class="tab-pane fade" id="nav-add_vars" role="tabpanel" aria-labelledby="nav-add_vars-tab">
<!--                    this is addin variables-->

                    <form id="form_add_vars" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">

                        <input type="hidden" id='output_add_vars' name="output">

                        <div class="bg-light rounded h-100 p-4" id="group_addin_vars">

                            {% for key, val in prj.detail.addin_vars.items() %}
                                <div class="row g-0 p-4" id="detail.addin_vars.{{ key }}">

                                    <div class="d-flex align-items-center justify-content-between p-1">
                                        <h6 class="mb-1">#{{ key }}</h6>
                                        <button type="button" class="btn btn-outline-danger" onclick="Del_variable('detail.addin_vars.{{ key }}', 'group_addin_vars');">Delete</button>
                                    </div>


                                    <div class="col-sm-12 col-xl-6">
                                        <div class="bg-light rounded h-100 p-1">
                                            <div class="form-floating mb-0">
                                                <input type="text" class="form-control" id="detail.addin_vars.{{ key }}.name"
                                                       name="detail.addin_vars.{{ key }}.name" value="{{ val.name }}" placeholder="">
                                                <label for="detail.addin_vars.{{ key }}.name">Name</label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-12 col-xl-6">
                                        <div class="bg-light rounded h-100 p-1">
                                            <div class="form-floating mb-0">
                                                <input type="text" class="form-control" id="detail.addin_vars.{{ key }}.lbl"
                                                       name="detail.addin_vars.{{ key }}.lbl" value="{{ val.lbl }}" placeholder="">
                                                <label for="detail.addin_vars.{{ key }}.lbl">Label</label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="table-responsive p-1">
                                        <table class="table text-start align-middle table-bordered table-hover mb-0">
                                            <thead>
                                                <tr class="text-dark">
                                                    <th scope="col">Value</th>
                                                    <th scope="col">Label</th>
                                                    <th scope="col">Condition</th>
                                                    <th scope="col"></th>
                                                </tr>
                                            </thead>
                                            <tbody id="detail.addin_vars.{{ key }}.cats">

                                                {% if val.cats %}

                                                    {% for k_cat, v_cat in val.cats.items() %}

                                                        <tr id="detail.addin_vars.{{ key }}.cats.{{ k_cat }}.row">
                                                            <td width="10%"><input type="text" class="form-control" id="detail.addin_vars.{{ key }}.cats.{{ k_cat }}.val"
                                                                   name="detail.addin_vars.{{ key }}.cats.{{ k_cat }}.val" value="{{ v_cat.val }}" placeholder="" aria-label=""></td>

                                                            <td width="30%"><input type="text" class="form-control" id="detail.addin_vars.{{ key }}.cats.{{ k_cat }}.lbl"
                                                                   name="detail.addin_vars.{{ key }}.cats.{{ k_cat }}.lbl" value="{{ v_cat.lbl }}" placeholder="" aria-label=""></td>

                                                            <td width="55%"><input type="text" class="form-control" id="detail.addin_vars.{{ key }}.cats.{{ k_cat }}.condition"
                                                                   name="detail.addin_vars.{{ key }}.cats.{{ k_cat }}.condition" value="{{ v_cat.condition }}" placeholder="" aria-label=""></td>

                                                            <td width="5%"><button type="button" class="btn btn-outline-danger" onclick="Del_variable_cat('detail.addin_vars.{{ key }}.cats.{{ k_cat }}.row');">X</button></td>
                                                        </tr>

                                                    {% endfor %}

                                                {% else %}

<!--                                                    <tr>-->
<!--                                                        <td>=></td>-->
<!--                                                        <td>Add value</td>-->
<!--                                                        <td></td>-->
<!--                                                        <td><=</td>-->
<!--                                                    </tr>-->

                                                {% endif %}

                                            </tbody>
                                        </table>

                                    </div>

                                    <div class="col-sm-12 col-xl-6">
                                        <div class="bg-light rounded h-100 p-1 ">
                                            <button type="button" class="btn btn-outline-primary" onclick="Add_variable_cat('detail.addin_vars.{{ key }}.cats');">+</button>
                                        </div>
                                    </div>

                                    <hr>
                                </div>


                            {% endfor %}

                        </div>

                        <div class="bg-light rounded h-100 p-4">
                            <div class="d-flex align-items-center justify-content-between mb-0">
                                <button type="button" class="btn btn-outline-primary py-3 w-25" onclick="Add_variable('group_addin_vars');">Add variable</button>
                                <input class="btn btn-primary py-3 w-25" type="submit" id="submit_add_vars" value="Submit add variables" onclick="fnc_submit('add_vars', false)">
                            </div>
                        </div>

                    </form>

                </div>

                <div class="tab-pane fade" id="nav-topline" role="tabpanel" aria-labelledby="nav-topline-tab">
<!--                    this is topline-->

                    <form id="form_topline" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">
                        <input type="hidden" id='output_topline' name="output">

                        <input type="hidden" id='detail.topline_design.is_display_pct_sign' name="detail.topline_design.is_display_pct_sign" value="{{ prj.detail.topline_design.is_display_pct_sign }}">

                        <input type="hidden" id='detail.topline_design.is_jar_scale_3' name="detail.topline_design.is_jar_scale_3" value="{{ prj.detail.topline_design.is_jar_scale_3 }}">

                        <div class="row g-0 p-4">

                            <div class="col-sm-12 col-xl-6">
                                <div class="bg-light rounded h-100 p-1">
                                    <div class="form-check form-switch">

                                        <input class="form-check-input" type="checkbox" role="switch"
                                                   id="cbx_is_display_pct_sign" onclick="cbxClick(this, 'detail.topline_design.is_display_pct_sign');">
                                        <label class="form-check-label" for="cbx_is_display_pct_sign">Display percentage sign(%)</label>

                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-12 col-xl-6">
                                <div class="bg-light rounded h-100 p-1">
                                    <div class="form-check form-switch">

                                        <input class="form-check-input" type="checkbox" role="switch"
                                                   id="cbx_is_jar_scale_3" onclick="cbxClick(this, 'detail.topline_design.is_jar_scale_3');">
                                        <label class="form-check-label" for="cbx_is_jar_scale_3">Run JAR mean base on scale 3</label>

                                    </div>
                                </div>
                            </div>

                        </div>

                        <div class="bg-light rounded h-100 p-4">
                            <div class="accordion accordion-flush" id="accordionFlushExample">
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="flush-headingOne">
                                        <button class="accordion-button" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#flush-collapseOne"
                                            aria-expanded="true" aria-controls="flush-collapseOne">
                                            <b>Header</b>
                                        </button>
                                    </h2>

                                    <div id="flush-collapseOne" class="accordion-collapse collapse show"
                                        aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample">
                                        <div class="accordion-body">
<!--                                            topline header-->
                                            <div class="table-responsive p-1">
                                                <table class="table text-start align-middle table-bordered table-hover mb-0">
                                                    <thead>
                                                        <tr class="text-dark">
                                                            <th scope="col">Name</th>
                                                            <th scope="col">Label</th>
                                                            <th scope="col">Hidden categories</th>
                                                            <th scope="col"></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="detail.topline_design.header">

                                                        {% if prj.detail.topline_design.header %}

                                                            {% for k_hd, v_hd in prj.detail.topline_design.header.items() %}

                                                                <tr id="detail.topline_design.header.{{ k_hd }}.row">
                                                                    <td width="40%"><input type="text" class="form-control" id="detail.topline_design.header.{{ k_hd }}.name"
                                                                       name="detail.topline_design.header.{{ k_hd }}.name" value="{{ v_hd.name }}"></td>

                                                                    <td width="20%"><input type="text" class="form-control" id="detail.topline_design.header.{{ k_hd }}.lbl"
                                                                       name="detail.topline_design.header.{{ k_hd }}.lbl" value="{{ v_hd.lbl }}"></td>

                                                                    <td width="35%"><input type="text" class="form-control" id="detail.topline_design.header.{{ k_hd }}.hidden_cats"
                                                                       name="detail.topline_design.header.{{ k_hd }}.hidden_cats" value="{{ v_hd.hidden_cats }}"></td>

                                                                    <td width="5%"><button type="button" class="btn btn-outline-danger"
                                                                       id="detail.topline_design.header.{{ k_hd }}.btn_del"
                                                                       onclick="Del_topline_header_item('detail.topline_design.header.{{ k_hd }}.row');">X</button></td>
                                                                </tr>

                                                            {% endfor %}

                                                        {% endif %}

                                                    </tbody>
                                                </table>
                                            </div>

                                            <div class="d-flex align-items-center justify-content-between p-1">
                                                <button type="button" class="btn btn-outline-primary" onclick="Add_topline_header_item('detail.topline_design.header');">+</button>
                                                <button type="button" class="btn btn-outline-primary" onclick="showDialog('dialog_bulkup_topline_header')">Bulk-up header</button>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="flush-headingTwo">
                                        <button class="accordion-button collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#flush-collapseTwo"
                                            aria-expanded="false" aria-controls="flush-collapseTwo">
                                            <b>Side axis</b>
                                        </button>
                                    </h2>
                                    <div id="flush-collapseTwo" class="accordion-collapse collapse"
                                        aria-labelledby="flush-headingTwo" data-bs-parent="#accordionFlushExample">
                                        <div class="accordion-body">
<!--                                            topline side axis-->

                                            <div class="bg-light rounded h-100 p-2" id="group_topline_side_items">

                                                {% if prj.detail.topline_design.side %}

                                                    {% for key, val in prj.detail.topline_design.side.items() %}

                                                        <div class="row g-0 p-2" id="detail.topline_design.side.{{ key }}">

                                                            <div class="d-flex align-items-center justify-content-between p-1">
                                                                <h6 class="mb-1">#{{ key }}</h6>
                                                                <button type="button" class="btn btn-outline-danger" onclick="Del_topline_side_item('detail.topline_design.side.{{ key }}', 'group_topline_side_items');">Delete</button>
                                                            </div>

                                                            <div class="col-sm-12 col-xl-6">
                                                                <div class="form-floating p-1">
                                                                    <input type="text" class="form-control" id="detail.topline_design.side.{{ key }}.group_lbl"
                                                                           name="detail.topline_design.side.{{ key }}.group_lbl" value="{{ val.group_lbl }}">
                                                                    <label for="detail.topline_design.side.{{ key }}.group_lbl">Group</label>
                                                                </div>
                                                            </div>

                                                            <div class="col-sm-12 col-xl-6">
                                                                <div class="form-floating p-1">
                                                                    <input type="text" class="form-control" id="detail.topline_design.side.{{ key }}.name"
                                                                           name="detail.topline_design.side.{{ key }}.name" value="{{ val.name }}">
                                                                    <label for="detail.topline_design.side.{{ key }}.name">Name</label>
                                                                </div>
                                                            </div>

                                                            <div class="col-sm-12 col-xl-6">
                                                                <div class="form-floating p-1">
                                                                    <input type="text" class="form-control" id="detail.topline_design.side.{{ key }}.lbl"
                                                                           name="detail.topline_design.side.{{ key }}.lbl" value="{{ val.lbl }}">
                                                                    <label for="detail.topline_design.side.{{ key }}.lbl">Label</label>
                                                                </div>
                                                            </div>

                                                            <div class="col-sm-12 col-xl-6">
                                                                <div class="form-floating p-1">
                                                                    <select class="form-select" id="detail.topline_design.side.{{ key }}.type"
                                                                            name="detail.topline_design.side.{{ key }}.type"
                                                                            onchange="topline_side_type(this);">

                                                                        {% for _type in ['OL', 'JR', 'FC', 'SA', 'MA', 'NUM'] %}

                                                                            {% if val.type == _type %}
                                                                                <option selected value="{{ _type }}">{{ _type }}</option>
                                                                            {% else %}
                                                                                <option value="{{ _type }}">{{ _type }}</option>
                                                                            {% endif %}

                                                                        {% endfor %}

                                                                    </select>
                                                                    <label for="detail.topline_design.side.{{ key }}.type">Type</label>
                                                                </div>
                                                            </div>

                                                            <div class="col-sm-12 col-xl-6">
                                                                <div class="form-floating p-1">

                                                                    <div class="form-check form-check-inline form-switch">
                                                                        <input class="form-check-input" type="checkbox" role="switch"
                                                                               id="detail.topline_design.side.{{ key }}.t2b"
                                                                               name="detail.topline_design.side.{{ key }}.t2b"
                                                                               value="{{ val.t2b }}"
                                                                               onclick="cbxClick(this, 'detail.topline_design.side.{{ key }}.t2b');">
                                                                        <label class="form-check-label" for="detail.topline_design.side.{{ key }}.t2b">T2B</label>
                                                                    </div>
                                                                    <div class="form-check form-check-inline form-switch">
                                                                        <input class="form-check-input" type="checkbox" role="switch"
                                                                               id="detail.topline_design.side.{{ key }}.b2b"
                                                                               name="detail.topline_design.side.{{ key }}.b2b"
                                                                               value="{{ val.b2b }}"
                                                                               onclick="cbxClick(this, 'detail.topline_design.side.{{ key }}.b2b');">
                                                                        <label class="form-check-label" for="detail.topline_design.side.{{ key }}.b2b">B2B</label>
                                                                    </div>
                                                                    <div class="form-check form-check-inline form-switch">
                                                                        <input class="form-check-input" type="checkbox" role="switch"
                                                                               id="detail.topline_design.side.{{ key }}.mean"
                                                                               name="detail.topline_design.side.{{ key }}.mean"
                                                                               value="{{ val.mean }}"
                                                                               onclick="cbxClick(this, 'detail.topline_design.side.{{ key }}.mean');">
                                                                        <label class="form-check-label" for="detail.topline_design.side.{{ key }}.mean">Mean</label>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div class="col-sm-12 col-xl-6">
                                                                <div class="form-floating p-1">

                                                                    <div class="form-check form-check-inline form-switch">
                                                                        <input class="form-check-input" type="checkbox" role="switch"
                                                                               id="detail.topline_design.side.{{ key }}.is_count"
                                                                               name="detail.topline_design.side.{{ key }}.is_count"
                                                                               value="{{ val.is_count }}"
                                                                               onclick="cbxClick(this, 'detail.topline_design.side.{{ key }}.is_count');">
                                                                        <label class="form-check-label" for="detail.topline_design.side.{{ key }}.is_count">Display count</label>
                                                                    </div>
                                                                    <div class="form-check form-check-inline form-switch">
                                                                        <input class="form-check-input" type="checkbox" role="switch"
                                                                               id="detail.topline_design.side.{{ key }}.is_corr"
                                                                               name="detail.topline_design.side.{{ key }}.is_corr"
                                                                               value="{{ val.is_corr }}"
                                                                               onclick="cbxClick(this, 'detail.topline_design.side.{{ key }}.is_corr');">
                                                                        <label class="form-check-label" for="detail.topline_design.side.{{ key }}.is_corr">Correlation</label>
                                                                    </div>
                                                                    <div class="form-check form-check-inline form-switch">
                                                                        <input class="form-check-input" type="checkbox" role="switch"
                                                                               id="detail.topline_design.side.{{ key }}.is_ua"
                                                                               name="detail.topline_design.side.{{ key }}.is_ua"
                                                                               value="{{ val.is_ua }}"
                                                                               onclick="cbxClick(this, 'detail.topline_design.side.{{ key }}.is_ua');">
                                                                        <label class="form-check-label" for="detail.topline_design.side.{{ key }}.is_ua">U&A</label>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div class="col-sm-12 col-xl-6">
                                                                <div class="form-floating p-1">
                                                                    <input type="text" class="form-control" id="detail.topline_design.side.{{ key }}.ma_cats"
                                                                           name="detail.topline_design.side.{{ key }}.ma_cats" value="{{ val.ma_cats }}">
                                                                    <label for="detail.topline_design.side.{{ key }}.ma_cats">MA Categories</label>
                                                                </div>
                                                            </div>

                                                            <div class="col-sm-12 col-xl-6">
                                                                <div class="form-floating p-1">
                                                                    <input type="text" class="form-control" id="detail.topline_design.side.{{ key }}.hidden_cats"
                                                                           name="detail.topline_design.side.{{ key }}.hidden_cats" value="{{ val.hidden_cats }}">
                                                                    <label for="detail.topline_design.side.{{ key }}.hidden_cats">Hidden categories</label>
                                                                </div>
                                                            </div>

                                                            <hr>
                                                        </div>

                                                    {% endfor %}

                                                {% endif %}

                                            </div>

                                            <div class="d-flex align-items-center justify-content-between p-2">
                                                <button type="button" class="btn btn-outline-primary" onclick="Add_topline_side_item('group_topline_side_items');">+</button>
                                                <button type="button" class="btn btn-outline-primary" onclick="showDialog('dialog_bulkup_topline_side')">Bulk-up side</button>
                                            </div>

                                        </div>

                                    </div>
                                </div>

                            </div>
                        </div>


                        <div class="bg-light rounded h-100 p-4">
                            <div class="d-flex align-items-center justify-content-end mb-4">
                                <input class="btn btn-primary py-3 w-25" type="submit" value="Submit topline" onclick="fnc_submit('topline', false)">
                            </div>
                        </div>
                    </form>

<!--                    dialog for bulkup topline header-->
                    <dialog id="dialog_bulkup_topline_header" class="col-sm-12 col-xl-6">

                        <div class="bg-light rounded h-100 p-4">

                            <div class="d-flex align-items-center justify-content-between mb-2">
                                <h5 class="mb-2">Bulk-up topline header</h5>
                            </div>

                            <form id="form_bulkup_topline_header" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">

                                <input type="hidden" id='output_bulkup_topline_header' name="output">

                                <div class="align-items-center justify-content-between mb-2">

                                    <div class="form-floating">
                                        <textarea class="form-control" placeholder="Leave a input here"
                                            id="floatingTextarea_bulkup_topline_header" name="detail.topline_design.header" style="height: 500px"></textarea>
                                        <label for="floatingTextarea_bulkup_topline_header">Leave an input here</label>
                                    </div>

                                </div>

                                <div class="d-flex align-items-center justify-content-end mb-2">
                                    <button type="button" class="btn btn-secondary py-3 w-25" onclick="closeDialog('dialog_bulkup_topline_header')">Close</button>
                                    <input class="btn btn-primary py-3 w-25" type="submit" value="Submit" id="submit_bulkup_topline_header" onclick="fnc_submit('bulkup_topline_header', true)">
                                </div>

                            </form>

                        </div>

                    </dialog>

                    <!--                    dialog for bulkup topline side-->
                    <dialog id="dialog_bulkup_topline_side" class="col-sm-12 col-xl-6">

                        <div class="bg-light rounded h-100 p-4">

                            <div class="d-flex align-items-center justify-content-between mb-2">
                                <h5 class="mb-2">Bulk-up topline side</h5>
                            </div>

                            <form id="form_bulkup_topline_side" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">

                                <input type="hidden" id='output_bulkup_topline_side' name="output">

                                <div class="align-items-center justify-content-between mb-2">

                                    <div class="form-floating">
                                        <textarea class="form-control" placeholder="Leave a input here"
                                            id="floatingTextarea_bulkup_topline_side" name="detail.topline_design.side" style="height: 500px"></textarea>
                                        <label for="floatingTextarea_bulkup_topline_side">Leave an input here</label>
                                    </div>

                                </div>

                                <div class="d-flex align-items-center justify-content-end mb-2">
                                    <button type="button" class="btn btn-secondary py-3 w-25" onclick="closeDialog('dialog_bulkup_topline_side')">Close</button>
                                    <input class="btn btn-primary py-3 w-25" type="submit" value="Submit" id="submit_bulkup_topline_side" onclick="fnc_submit('bulkup_topline_side', true)">
                                </div>

                            </form>

                        </div>

                    </dialog>

                </div>

                <div class="tab-pane fade" id="nav-data" role="tabpanel" aria-labelledby="nav-data-tab">
<!--                    this is data-->

                    <form id="form_data_clear" action="/msn-prj/data_clear/{{ prj.id }}" method="post" enctype="multipart/form-data">

                        <div class="row g-4 p-4">

                            <div class="col-sm-12 col-xl-4">
                                <h5>Screener = {{ prj.lenOfScr }} res</h5>
                            </div>

                            <div class="col-sm-12 col-xl-4">
                                <h5>Main = {{ prj.lenOfMain }} res</h5>
                            </div>

                            <div class="col-sm-12 col-xl-4">
                                <input class="btn btn-outline-danger py-3 w-100" type="submit" value="Clear data" onclick="fnc_submit_clear_data()">
                            </div>

                        </div>

                    </form>

                    <hr>

                    <form id="form_data_upload" action="/msn-prj/data_upload/{{ prj.id }}" method="post" enctype="multipart/form-data">

                        <h3 class="bg-light rounded h-100 p-2">Upload Rawdata</h3>

                        <div class="row g-4 p-4">

                            <div class="col-sm-12 col-xl-4">
                                <label for="file_scr" class="form-label">Choose screener file</label>
                                <input class="form-control" type="file" id="file_scr" name="file_scr" multiple data-max="1" accept=".xlsx" value="">
                            </div>

                            <div class="col-sm-12 col-xl-4">
                                <label for="file_main" class="form-label">Choose main file</label>
                                <input class="form-control" type="file" id="file_main" name="file_main" multiple data-max="1" accept=".xlsx" value="">
                            </div>

                            <div class="col-sm-12 col-xl-4">
                                <input class="btn btn-primary py-3 w-100" type="submit" value="Upload data">
                            </div>

                        </div>

                    </form>

                    <hr>

                    <form id="form_data_export" action="/msn-prj/data_export/{{ prj.id }}" method="get" enctype="multipart/form-data">

                        <h3 class="bg-light rounded h-100 p-2">Export Data</h3>
                        <h6 class="bg-light rounded h-100 p-3">Excel file & stack sav & unstack sav</h6>

                        <div class="row g-4 p-4">

                            <div class="col-sm-12 col-xl-4">
                                <h7 >Please select the section to export data.<br/> It will take a several minute</h7>
                            </div>

                            <div class="col-sm-12 col-xl-4">
                                <div class="form-floating mb-2">

                                    <select class="form-select" id="export_section"
                                        aria-label="Floating label select example"
                                        name="export_section">

                                        <option selected value="-1">Select section</option>

                                        {% for key, val in prj.detail.sections.items() %}
                                            <option value="{{ key }}">{{ val.name }}</option>
                                        {% endfor %}

                                    </select>

                                    <label for="export_section">Please select the data section</label>

                                </div>
                            </div>

                            <div class="col-sm-12 col-xl-4">
                                <input class="btn btn-primary py-3 w-100 mb-2" type="submit" value="Export data" onclick="submit_export_data('form_data_export');">
                            </div>

                        </div>

                    </form>

                    <hr>

                    <h3 class="bg-light rounded h-100 p-2">Process Topline / Handcount</h3>

                    {% if not prj.sec_topline_exporter %}
                        <div class="alert alert-warning" role="alert">
                            The topline is not processed. Please choose the <b>topline section</b> -> click <b>process topline</b>.
                        </div>
                    {% endif %}

                    <div class="row g-4 p-4">

                        <div class="col-sm-12 col-xl-4">
                            <h7 >Please select the section to export topline. It will take a several minute</h7>
                        </div>

                        <div class="col-sm-12 col-xl-4">
                            <div class="form-floating mb-2">

                                <select class="form-select" id="export_tl_section"
                                    aria-label="Floating label select example"
                                    name="export_tl_section">

                                    <option selected value="-1">Select section</option>

                                    {% for key, val in prj.detail.sections.items() %}
                                        <option value="{{ key }}">{{ val.name }}</option>
                                    {% endfor %}

                                </select>

                                <label for="export_tl_section">Please select the topline section</label>

                            </div>
                        </div>

                        <div class="col-sm-12 col-xl-4">
                            <form id="form_topline_process" action="/msn-prj/topline_process/{{ prj.id }}" method="get" enctype="multipart/form-data">
                                <input type="hidden" value="" id="export_tl_section_1" name="export_section">
                                <input class="btn btn-primary py-3 w-100 mb-2" type="submit" value="Process topline" onclick="fnc_process_tl_submit(this, 'form_topline_process');">
                            </form>
                        </div>
                    </div>

                    {% if prj.sec_topline_exporter %}

                        {% for key, val in prj.sec_topline_exporter.items()  %}
                            <hr>

                            <h3 class="bg-light rounded h-100 p-2">Export {{ val }} Handcount</h3>

                            <div class="row g-4 p-4">

                                <div class="col-sm-12 col-xl-4"></div>

                                <div class="col-sm-12 col-xl-4"></div>

                                <div class="col-sm-12 col-xl-4">
                                    <form id="form_handcount_export" action="/msn-prj/handcount_export/{{ prj.id }}" method="get" enctype="multipart/form-data">
                                        <input type="hidden" value="{{ key }}" name="export_section">
                                        <input class="btn btn-primary py-3 w-100 mb-0" type="submit" value="{{ val }} handcount" onclick="fnc_tl_submit(this, 'form_handcount_export', 'Handcount');">
                                    </form>
                                </div>

                            </div>

                            <hr>

                            <h3 class="bg-light rounded h-100 p-2">Export {{ val }} Topline</h3>

                            <div class="row g-4 p-4">

                                <div class="col-sm-12 col-xl-4">
                                    <form id="form_topline_export_product_1" action="/msn-prj/topline_export_product_1/{{ prj.id }}" method="get" enctype="multipart/form-data">
                                        <input type="hidden" value="{{ key }}" name="export_section">
                                        <input class="btn btn-outline-primary py-3 w-100 mb-0" type="submit" value="{{ val }} Summary + Tabulation" onclick="fnc_tl_submit(this, 'form_topline_export_product_1', 'Topline Summary + Tabulation Sheets');">
                                    </form>
                                </div>

                                <div class="col-sm-12 col-xl-4">
                                    <form id="form_topline_export_product_2" action="/msn-prj/topline_export_product_2/{{ prj.id }}" method="get" enctype="multipart/form-data">
                                        <input type="hidden" value="{{ key }}" name="export_section">
                                        <input class="btn btn-outline-primary py-3 w-100 mb-0" type="submit" value="{{ val }} OL + JR Summary" onclick="fnc_tl_submit(this, 'form_topline_export_product_2', 'Topline OL + JR Summary Sheets');">
                                    </form>
                                </div>

                                <div class="col-sm-12 col-xl-4">
                                    <form id="form_topline_export_ua" action="/msn-prj/topline_export_ua_corr/{{ prj.id }}" method="get" enctype="multipart/form-data">
                                        <input type="hidden" value="{{ key }}" name="export_section">
                                        <input class="btn btn-outline-primary py-3 w-100 mb-0" type="submit" value="{{ val }} U&A + Correlation" onclick="fnc_tl_submit(this, 'form_topline_export_ua', 'Topline U&A + Correlation Sheets');">
                                    </form>
                                </div>

                            </div>

                            <div class="row g-4 p-4">
                                <div class="col-sm-12 col-xl-4"></div>
                                <div class="col-sm-12 col-xl-4"></div>

                                <div class="col-sm-12 col-xl-4">
                                    <form id="form_topline_export" action="/msn-prj/topline_export/{{ prj.id }}" method="get" enctype="multipart/form-data">
                                        <input type="hidden" value="{{ key }}" name="export_section">
                                        <input class="btn btn-primary py-3 w-100 mb-0" type="submit" value="{{ val }} full topline" onclick="fnc_tl_submit(this, 'form_topline_export', 'Full Topline');">
                                    </form>
                                </div>
                            </div>

                        {% endfor %}
                    {% endif %}

                </div>

            </div>

        </div>

    </div>


{% endblock %}

{% block js_files %}
    <script src="{{ url_for('static', path='/js/my_frontend.js') }}"></script>

    <script>
        setTimeout(() => {
            const err = document.getElementById('err');
            err.style.display = 'none';
        }, 3000);

        window.addEventListener('load', function() {

            a = document.getElementById('detail.topline_design.is_display_pct_sign');
            b = document.getElementById('detail.topline_design.is_jar_scale_3');

            c = document.getElementById('cbx_is_display_pct_sign');
            d = document.getElementById('cbx_is_jar_scale_3');

            if (a.value == "True") {
                c.checked = true;
            }
            else {
                c.checked = false;
            }

            if (b.value == "True") {
                d.checked = true;
            }
            else {
                d.checked = false;
            }

            var elm_group_tl_side_items = document.getElementById('group_topline_side_items');

            for (idx in elm_group_tl_side_items.children)
            {
                child = elm_group_tl_side_items.children.item(idx);
                childID = child.id;

                arr = ['t2b', 'b2b', 'mean', 'is_count', 'is_corr', 'is_ua'];

                for(var i = 0; i < arr.length; i++){
                    childItem = document.getElementById(childID + "." + arr[i]);

                    a = childItem.value

                    if(childItem.value == "True")
                    {
                        childItem.checked = true;
                    }
                    else {
                        childItem.checked = false;
                    }
                }

            }

        });

    </script>
{% endblock %}