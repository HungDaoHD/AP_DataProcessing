{% extends 'master_page.html' %}

{% block sidebar_MSN_prj %}
    <a href="\msn-prj" class="nav-item nav-link active"><i class="fa fa-tachometer-alt me-2"></i>MSN projects</a>
{% endblock %}

{% block content %}
    <div class="container-fluid pt-4 px-4">

            {% if strErr|trim|length %}
                <div id="err" class="alert alert-danger" role="alert">
                    {{ strErr }}
                </div>
            {% endif %}

            <div class="bg-light text-center rounded p-4">
                <div class="d-flex align-items-center justify-content-between mb-0">
                    <h3 class="mb-0">{{ prj.internal_id }} - {{ prj.name }}</h3>

                    <div>
                        <h7 class="mb-0">{{ prj.categorical }}</h7><br/>
                        <h7 class="mb-0">{{ prj.status }}</h7>
                    </div>

                </div>

            </div>

        </div>


    <div class="container-fluid pt-4 px-4">

        <div class="bg-light rounded h-100 p-4">

            <nav>
                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                    <button class="nav-link active" id="nav-info-tab" data-bs-toggle="tab"
                        data-bs-target="#nav-info" type="button" role="tab" aria-controls="nav-info"
                        aria-selected="true">Information</button>

                    <button class="nav-link" id="nav-sections-tab" data-bs-toggle="tab"
                        data-bs-target="#nav-sections" type="button" role="tab" aria-controls="nav-sections"
                        aria-selected="false">Sections</button>

                    <button class="nav-link" id="nav-oe_combine-tab" data-bs-toggle="tab"
                        data-bs-target="#nav-oe_combine" type="button" role="tab" aria-controls="nav-oe_combine"
                        aria-selected="false">OE combine</button>

                    <button class="nav-link" id="nav-scr-tab" data-bs-toggle="tab"
                        data-bs-target="#nav-scr" type="button" role="tab" aria-controls="nav-scr"
                        aria-selected="false">Screener</button>

                    <button class="nav-link" id="nav-pro-tab" data-bs-toggle="tab"
                        data-bs-target="#nav-pro" type="button" role="tab" aria-controls="nav-pro"
                        aria-selected="false">Product</button>

                    <button class="nav-link" id="nav-fc-tab" data-bs-toggle="tab"
                        data-bs-target="#nav-fc" type="button" role="tab" aria-controls="nav-fc"
                        aria-selected="false">Force choice</button>

                    <button class="nav-link" id="nav-add_vars-tab" data-bs-toggle="tab"
                        data-bs-target="#nav-add_vars" type="button" role="tab" aria-controls="nav-add_vars"
                        aria-selected="false">Addin variables</button>

                    <button class="nav-link" id="nav-topline-tab" data-bs-toggle="tab"
                        data-bs-target="#nav-topline" type="button" role="tab" aria-controls="nav-topline"
                        aria-selected="false">Topline design</button>

                    <button class="nav-link" id="nav-data-tab" data-bs-toggle="tab"
                        data-bs-target="#nav-data" type="button" role="tab" aria-controls="nav-data"
                        aria-selected="false">Data</button>

                </div>
            </nav>



            <div class="tab-content pt-3" id="nav-tabContent">


                <div class="tab-pane fade show active" id="nav-info" role="tabpanel" aria-labelledby="nav-info-tab">
<!--                    this is information-->
                    <form id="form_info" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">
                        <input type="hidden" id='output_info' name="output">

                        <div class="row g-0">
                            <div class="col-sm-12 col-xl-6">
                                <div class="bg-light rounded h-100 p-4">
                                    <div class="form-floating mb-0">
                                        <input type="text" class="form-control" id="internal_id"
                                               name="internal_id" value="{{ prj.internal_id }}" placeholder="">
                                        <label for="internal_id">Internal ID</label>
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-12 col-xl-6">
                                <div class="bg-light rounded h-100 p-4">
                                    <div class="form-floating mb-0">
                                        <input type="text" class="form-control" id="prj_name"
                                               name="name" value="{{ prj.name }}" placeholder="">
                                        <label for="prj_name">Name</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row g-0">
                            <div class="col-sm-12 col-xl-6">
                                <div class="bg-light rounded h-100 p-4">
                                    <div class="form-floating mb-0">
                                        <input type="text" class="form-control" id="prj_cat"
                                               name="categorical" value="{{ prj.categorical }}" placeholder="">
                                        <label for="prj_cat">Category</label>
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-12 col-xl-6">
                                <div class="bg-light rounded h-100 p-4">
                                    <div class="form-floating mb-0">

                                        <select class="form-select" id="floatingSelect_status"
                                            aria-label="Floating label select example"
                                            name="status">

                                            {% for stt in ['Completed', 'On Going', 'Pending', 'Cancel'] %}

                                                {% if prj.status == stt %}
                                                    <option selected value="{{ stt }}">{{ stt }}</option>
                                                {% else %}
                                                    <option value="{{ stt }}">{{ stt }}</option>
                                                {% endif %}

                                            {% endfor %}

                                        </select>
                                        <label for="floatingSelect_status">Status</label>
                                    </div>

                                </div>
                            </div>
                        </div>


                        <div class="bg-light rounded h-100 p-4">
                            <div class="d-flex align-items-center justify-content-end mb-4">
                                <input class="btn btn-primary py-3 w-25" type="submit" value="Submit info" onclick="fnc_submit('info', false)">
                            </div>
                        </div>
                    </form>

                </div>

                <div class="tab-pane fade" id="nav-sections" role="tabpanel" aria-labelledby="nav-sections-tab">

<!--                    This is sections-->

                    <form id="form_sections" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">

                        <input type="hidden" id='output_sections' name="output">

                        <div class="bg-light rounded h-100 p-4">

                            <div class="form-floating mb-0">
                                <input type="text" class="form-control" id="join_col" name="detail.join_col" value="{{ prj.detail.join_col }}" placeholder="">
                                <label for="join_col">RID column</label>
                            </div>

                        </div>

                        {% for key, val in prj.detail.sections.items() %}

                            <div class="bg-light rounded h-100 p-4">
                                <h4 class="mb-0">Section {{ key }}</h4>

                                <div class="row g-0">

                                    <div class="col-sm-12 col-xl-6">
                                        <div class="bg-light rounded h-100 p-4">
                                            <div class="form-floating mb-0">
                                                <input type="text" class="form-control" id="detail.sections.{{ key }}.name"
                                                       name="detail.sections.{{ key }}.name" value="{{ val.name }}" placeholder="">
                                                <label for="detail.sections.{{ key }}.name">Name</label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-12 col-xl-6">
                                        <div class="bg-light rounded h-100 p-4">
                                            <div class="form-floating mb-0">
                                                <input type="text" class="form-control" id="detail.sections.{{ key }}.filter"
                                                       name="detail.sections.{{ key }}.filter" value="{{ val.filter }}" placeholder="">
                                                <label for="detail.sections.{{ key }}.filter">Filter</label>
                                            </div>
                                        </div>
                                    </div>


                                    {% for k_p, v_p in val.product_qres.items() %}
                                        <div class="col-sm-12 col-xl-6">
                                            <div class="bg-light rounded h-100 p-4">
                                                <h6 class="mb-3">Product {{ k_p }}</h6>

                                                    <div class="form-floating mb-2">
                                                        <input type="text" class="form-control" id="detail.sections.{{ key }}.product_qres.{{ k_p }}.name"
                                                               name="detail.sections.{{ key }}.product_qres.{{ k_p }}.name" value="{{ v_p.name }}" placeholder="">
                                                        <label for="detail.sections.{{ key }}.product_qres.{{ k_p }}.name">Name</label>
                                                    </div>

                                                    <div class="form-floating mb-2">
                                                        <input type="text" class="form-control" id="detail.sections.{{ key }}.product_qres.{{ k_p }}.lbl"
                                                               name="detail.sections.{{ key }}.product_qres.{{ k_p }}.lbl" value="{{ v_p.lbl }}" placeholder="">
                                                        <label for="detail.sections.{{ key }}.product_qres.{{ k_p }}.lbl">Label</label>
                                                    </div>

                                                    <div class="form-floating mb-2">
                                                        <input type="text" class="form-control" id="detail.sections.{{ key }}.product_qres.{{ k_p }}.qres.0"
                                                               name="detail.sections.{{ key }}.product_qres.{{ k_p }}.qres.0" value="{{ v_p.qres[0] }}" placeholder="">
                                                        <label for="detail.sections.{{ key }}.product_qres.{{ k_p }}.qres.0">Get data from</label>
                                                    </div>

                                                    {% for k_cat, v_cat in v_p.cats.items() %}

                                                        <div class="input-group mb-1">
                                                            <span class="input-group-text">Value</span>

                                                            <input type="text" class="form-control" id="detail.sections.{{ key }}.product_qres.{{ k_p }}.cats.{{ k_cat }}.val"
                                                                   name="detail.sections.{{ key }}.product_qres.{{ k_p }}.cats.{{ k_cat }}.val"
                                                                   value="{{ v_cat.val }}" placeholder="" aria-label="">

                                                            <span class="input-group-text">Label</span>

                                                            <input type="text" class="form-control" id="detail.sections.{{ key }}.product_qres.{{ k_p }}.cats.{{ k_cat }}.lbl"
                                                                   name="detail.sections.{{ key }}.product_qres.{{ k_p }}.cats.{{ k_cat }}.lbl"
                                                                   value="{{ v_cat.lbl }}" placeholder="" aria-label="">
                                                        </div>

                                                    {% endfor %}


                                            </div>

                                        </div>

                                    {% endfor %}

                                    <div class="bg-light rounded h-100 p-4 mb-0">
                                        <div class="form-floating mb-0">
                                            <input type="text" class="form-control" id="detail.sections.{{ key }}.fc_qres.0"
                                                   name="detail.sections.{{ key }}.fc_qres.0"
                                                   value="{{ val.fc_qres[0] }}" placeholder="">
                                            <label for="detail.sections.{{ key }}.fc_qres.0">Force choice question</label>
                                        </div>
                                    </div>


                                </div>

                            </div>

                        {% endfor %}

                        <div class="bg-light rounded h-100 p-4">
                            <div class="d-flex align-items-center justify-content-end mb-4">
                                <input class="btn btn-primary py-3 w-25" type="submit" value="Submit sections" onclick="fnc_submit('sections', false)">
                            </div>
                        </div>

                    </form>

                </div>

                <div class="tab-pane fade" id="nav-oe_combine" role="tabpanel" aria-labelledby="nav-oe_combine-tab">
<!--                        this is oe combine-->

                    <dialog id="dialog_bulkup_oe_combine" class="col-sm-12 col-xl-6">

                        <div class="bg-light rounded h-100 p-4">

                            <div class="d-flex align-items-center justify-content-between mb-2">
                                <h5 class="mb-2">Bulk-up OE Combine</h5>
                            </div>

                            <form id="form_bulkup_oe_combine" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">

                                <input type="hidden" id='output_bulkup_oe_combine' name="output">

                                <div class="align-items-center justify-content-between mb-2">

                                    <div class="form-floating">
                                        <textarea class="form-control" placeholder="Leave a input here"
                                            id="floatingTextarea_oe_combine" name="detail.oe_combine_cols" style="height: 500px"></textarea>
                                        <label for="floatingTextarea_oe_combine">Leave an input here</label>
                                    </div>

                                </div>

                                <div class="d-flex align-items-center justify-content-end mb-2">
                                    <button type="button" class="btn btn-secondary py-3 w-25" onclick="closeDialog('dialog_bulkup_oe_combine')">Close</button>
                                    <input class="btn btn-primary py-3 w-25" type="submit" value="Submit" id="submit_bulkup_oe_combine" onclick="fnc_submit('bulkup_oe_combine', true)">
                                </div>

                            </form>

                        </div>

                    </dialog>


                    <form id="form_oe_combine" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">

                        <input type="hidden" id='output_oe_combine' name="output">

                        <div class="bg-light rounded h-100 p-4">
                            <div class="row g-1">

                                {% if prj.detail.oe_combine_cols %}

                                    {% for key, val in prj.detail.oe_combine_cols.items() %}

                                        <div class="input-group mb-1">
                                            <span class="input-group-text">{{ key }}</span>

                                            <input type="text" class="form-control" id="detail.oe_combine_cols.{{ key }}.0"
                                                   name="detail.oe_combine_cols.{{ key }}.0" value="{{ val[0] }}" placeholder="" aria-label="">

                                            <span class="input-group-text">=</span>

                                            <input type="text" class="form-control" id="detail.oe_combine_cols.{{ key }}.1"
                                                   name="detail.oe_combine_cols.{{ key }}.1" value="{{ val[1] }}" placeholder="" aria-label="">

                                            <span class="input-group-text">+</span>

                                            <input type="text" class="form-control" id="detail.oe_combine_cols.{{ key }}.2"
                                                   name="detail.oe_combine_cols.{{ key }}.2" value="{{ val[2] }}" placeholder="" aria-label="">
                                        </div>

                                    {% endfor %}

                                {% else %}

                                    <div class="d-flex align-items-center justify-content-center mb-2">
                                        <h6 class="mb-2">Bulk it up</h6>
                                    </div>

                                {% endif %}

                            </div>
                        </div>

                        <div class="bg-light rounded h-100 p-4">
                            <div class="d-flex align-items-center justify-content-between mb-0">
                                <button type="button" class="btn btn-outline-primary py-3 w-25" onclick="showDialog('dialog_bulkup_oe_combine')">Bulk-up</button>
                                <input class="btn btn-primary py-3 w-25 mb-0" type="submit" id="submit_oe_combine" value="Submit OE combine" onclick="fnc_submit('oe_combine', false)">
                            </div>
                        </div>

                    </form>

                </div>

                <div class="tab-pane fade" id="nav-scr" role="tabpanel" aria-labelledby="nav-scr-tab">
<!--                    this is screener-->

                    <dialog id="dialog_bulkup_scr_cols" class="col-sm-12 col-xl-6">

                        <div class="bg-light rounded h-100 p-4">

                            <div class="d-flex align-items-center justify-content-between mb-2">
                                <h5 class="mb-2">Bulk-up screener columns</h5>
                            </div>

                            <form id="form_bulkup_scr_cols" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">

                                <input type="hidden" id='output_bulkup_scr_cols' name="output">

                                <div class="align-items-center justify-content-between mb-2">

                                    <div class="form-floating">
                                        <textarea class="form-control" placeholder="Leave a input here"
                                            id="floatingTextarea_scr_cols" name="detail.scr_cols" style="height: 500px"></textarea>
                                        <label for="floatingTextarea_scr_cols">Leave an input here</label>
                                    </div>

                                </div>

                                <div class="d-flex align-items-center justify-content-end mb-2">
                                    <button type="button" class="btn btn-secondary py-3 w-25" onclick="closeDialog('dialog_bulkup_scr_cols')">Close</button>
                                    <input class="btn btn-primary py-3 w-25" type="submit" value="Submit" id="submit_bulkup_scr_cols" onclick="fnc_submit('bulkup_scr_cols', true)">
                                </div>

                            </form>

                        </div>

                    </dialog>


                    <form id="form_scr_cols" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">

                        <input type="hidden" id='output_scr_cols' name="output">

                        <div class="bg-light rounded h-100 p-4">

                            <div class="table-responsive">
                                <table class="table text-start align-middle table-bordered table-hover mb-0">
                                    <thead>
                                        <tr class="text-dark">
                                            <th scope="col">#</th>
                                            <th scope="col">Output data column name</th>
                                            <th scope="col">Rawdata column name</th>
                                        </tr>
                                    </thead>
                                    <tbody>

                                        {% if prj.detail.scr_cols %}

                                            {% for key, val in prj.detail.scr_cols.items() %}

                                                <tr>
                                                    <td>{{ key }}</td>
                                                    <td><input type="text" class="form-control" id="detail.scr_cols.{{ key }}.0"
                                                           name="detail.scr_cols.{{ key }}.0" value="{{ val[0] }}" placeholder="" aria-label=""></td>
                                                    <td><input type="text" class="form-control" id="detail.scr_cols.{{ key }}.1"
                                                           name="detail.scr_cols.{{ key }}.1" value="{{ val[1] }}" placeholder="" aria-label=""></td>
                                                </tr>

                                            {% endfor %}

                                        {% else %}

                                            <tr>
                                                <td>=></td>
                                                <td>Bulk it up</td>
                                                <td><=</td>
                                            </tr>

                                        {% endif %}

                                    </tbody>
                                </table>
                            </div>

                        </div>


                        <div class="bg-light rounded h-100 p-4">
                            <div class="d-flex align-items-center justify-content-between mb-0">
                                <button type="button" class="btn btn-outline-primary py-3 w-25" onclick="showDialog('dialog_bulkup_scr_cols')">Bulk-up</button>
                                <input class="btn btn-primary py-3 w-25" type="submit" id="submit_scr_cols" value="Submit screener" onclick="fnc_submit('scr_cols', false)">
                            </div>
                        </div>

                    </form>

                </div>

                <div class="tab-pane fade" id="nav-pro" role="tabpanel" aria-labelledby="nav-pro-tab">
<!--                    this is product-->

                    <dialog id="dialog_bulkup_product_cols" class="col-sm-12 col-xl-6">

                        <div class="bg-light rounded h-100 p-4">

                            <div class="d-flex align-items-center justify-content-between mb-2">
                                <h5 class="mb-2">Bulk-up product columns</h5>
                            </div>

                            <form id="form_bulkup_product_cols" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">

                                <input type="hidden" id='output_bulkup_product_cols' name="output">

                                <div class="align-items-center justify-content-between mb-2">

                                    <div class="form-floating">
                                        <textarea class="form-control" placeholder="Leave a input here"
                                            id="floatingTextarea_product_cols" name="detail.product_cols" style="height: 500px"></textarea>
                                        <label for="floatingTextarea_product_cols">Leave an input here</label>
                                    </div>

                                </div>

                                <div class="d-flex align-items-center justify-content-end mb-2">
                                    <button type="button" class="btn btn-secondary py-3 w-25" onclick="closeDialog('dialog_bulkup_product_cols')">Close</button>
                                    <input class="btn btn-primary py-3 w-25" type="submit" value="Submit" id="submit_bulkup_product_cols" onclick="fnc_submit('bulkup_product_cols', true)">
                                </div>

                            </form>

                        </div>

                    </dialog>


                    <form id="form_product_cols" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">

                        <input type="hidden" id='output_product_cols' name="output">

                        <div class="bg-light rounded h-100 p-4">

                            <div class="table-responsive">
                                <table class="table text-start align-middle table-bordered table-hover mb-0">
                                    <thead>
                                        <tr class="text-dark">
                                            <th scope="col">#</th>
                                            <th scope="col">Output data column name</th>
                                            <th scope="col">Rawdata 1st product col name</th>
                                            <th scope="col">Rawdata 2nd product col name</th>
                                        </tr>
                                    </thead>
                                    <tbody>

                                        {% if prj.detail.product_cols %}

                                            {% for key, val in prj.detail.product_cols.items() %}

                                                <tr>
                                                    <td>{{ key }}</td>
                                                    <td><input type="text" class="form-control" id="detail.product_cols.{{ key }}.0"
                                                           name="detail.product_cols.{{ key }}.0" value="{{ val[0] }}" placeholder="" aria-label=""></td>
                                                    <td><input type="text" class="form-control" id="detail.product_cols.{{ key }}.1"
                                                           name="detail.product_cols.{{ key }}.1" value="{{ val[1] }}" placeholder="" aria-label=""></td>
                                                    <td><input type="text" class="form-control" id="detail.product_cols.{{ key }}.2"
                                                           name="detail.product_cols.{{ key }}.2" value="{{ val[2] }}" placeholder="" aria-label=""></td>
                                                </tr>

                                            {% endfor %}

                                        {% else %}

                                            <tr>
                                                <td></td>
                                                <td>=></td>
                                                <td>Bulk it up</td>
                                                <td><=</td>
                                            </tr>

                                        {% endif %}

                                    </tbody>
                                </table>
                            </div>

                        </div>

                        <div class="bg-light rounded h-100 p-4">
                            <div class="d-flex align-items-center justify-content-between mb-0">
                                <button type="button" class="btn btn-outline-primary py-3 w-25" onclick="showDialog('dialog_bulkup_product_cols')">Bulk-up</button>
                                <input class="btn btn-primary py-3 w-25" type="submit" id="submit_product_cols" value="Submit product" onclick="fnc_submit('product_cols', false)">
                            </div>
                        </div>

                    </form>


                </div>

                <div class="tab-pane fade" id="nav-fc" role="tabpanel" aria-labelledby="nav-fc-tab">
<!--                    this is force choice-->

                    <dialog id="dialog_bulkup_fc_cols" class="col-sm-12 col-xl-6">

                        <div class="bg-light rounded h-100 p-4">

                            <div class="d-flex align-items-center justify-content-between mb-2">
                                <h5 class="mb-2">Bulk-up force choice columns</h5>
                            </div>

                            <form id="form_bulkup_fc_cols" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">

                                <input type="hidden" id='output_bulkup_fc_cols' name="output">

                                <div class="align-items-center justify-content-between mb-2">

                                    <div class="form-floating">
                                        <textarea class="form-control" placeholder="Leave a input here"
                                            id="floatingTextarea_fc_cols" name="detail.fc_cols" style="height: 500px"></textarea>
                                        <label for="floatingTextarea_fc_cols">Leave an input here</label>
                                    </div>

                                </div>

                                <div class="d-flex align-items-center justify-content-end mb-2">
                                    <button type="button" class="btn btn-secondary py-3 w-25" onclick="closeDialog('dialog_bulkup_fc_cols')">Close</button>
                                    <input class="btn btn-primary py-3 w-25" type="submit" value="Submit" id="submit_bulkup_fc_cols" onclick="fnc_submit('bulkup_fc_cols', true)">
                                </div>

                            </form>

                        </div>

                    </dialog>


                    <form id="form_fc_cols" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">

                        <input type="hidden" id='output_fc_cols' name="output">

                        <div class="bg-light rounded h-100 p-4">

                            <div class="table-responsive">
                                <table class="table text-start align-middle table-bordered table-hover mb-0">
                                    <thead>
                                        <tr class="text-dark">
                                            <th scope="col">#</th>
                                            <th scope="col">Output data column name</th>
                                            <th scope="col">Rawdata column name</th>
                                        </tr>
                                    </thead>
                                    <tbody>

                                        {% if prj.detail.fc_cols %}

                                            {% for key, val in prj.detail.fc_cols.items() %}

                                                <tr>
                                                    <td>{{ key }}</td>
                                                    <td><input type="text" class="form-control" id="detail.fc_cols.{{ key }}.0"
                                                           name="detail.fc_cols.{{ key }}.0" value="{{ val[0] }}" placeholder="" aria-label=""></td>
                                                    <td><input type="text" class="form-control" id="detail.fc_cols.{{ key }}.1"
                                                           name="detail.fc_cols.{{ key }}.1" value="{{ val[1] }}" placeholder="" aria-label=""></td>
                                                </tr>

                                            {% endfor %}

                                        {% else %}

                                            <tr>
                                                <td>=></td>
                                                <td>Bulk it up</td>
                                                <td><=</td>
                                            </tr>

                                        {% endif %}

                                    </tbody>
                                </table>
                            </div>

                        </div>

                        <div class="bg-light rounded h-100 p-4">
                            <div class="d-flex align-items-center justify-content-between mb-0">
                                <button type="button" class="btn btn-outline-primary py-3 w-25" onclick="showDialog('dialog_bulkup_fc_cols')">Bulk-up</button>
                                <input class="btn btn-primary py-3 w-25" type="submit" id="submit_fc_cols" value="Submit force choice" onclick="fnc_submit('fc_cols', false)">
                            </div>
                        </div>

                    </form>


                </div>

                <div class="tab-pane fade" id="nav-add_vars" role="tabpanel" aria-labelledby="nav-add_vars-tab">
<!--                    this is addin variables-->

                    <form id="form_add_vars" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">

                        <input type="hidden" id='output_add_vars' name="output">

                        <div class="bg-light rounded h-100 p-4" id="group_addin_vars">

                            {% for key, val in prj.detail.addin_vars.items() %}
                                <div class="row g-0 p-4" id="detail.addin_vars.{{ key }}">

                                    <div class="d-flex align-items-center justify-content-between p-1">
                                        <h6 class="mb-1">#{{ key }}</h6>
                                        <button type="button" class="btn btn-outline-danger" onclick="Del_variable('detail.addin_vars.{{ key }}', 'group_addin_vars');">Delete</button>
                                    </div>


                                    <div class="col-sm-12 col-xl-6">
                                        <div class="bg-light rounded h-100 p-1">
                                            <div class="form-floating mb-0">
                                                <input type="text" class="form-control" id="detail.addin_vars.{{ key }}.name"
                                                       name="detail.addin_vars.{{ key }}.name" value="{{ val.name }}" placeholder="">
                                                <label for="detail.addin_vars.{{ key }}.name">Name</label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-12 col-xl-6">
                                        <div class="bg-light rounded h-100 p-1">
                                            <div class="form-floating mb-0">
                                                <input type="text" class="form-control" id="detail.addin_vars.{{ key }}.lbl"
                                                       name="detail.addin_vars.{{ key }}.lbl" value="{{ val.lbl }}" placeholder="">
                                                <label for="detail.addin_vars.{{ key }}.lbl">Label</label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="table-responsive p-1">
                                        <table class="table text-start align-middle table-bordered table-hover mb-0">
                                            <thead>
                                                <tr class="text-dark">
                                                    <th scope="col">Value</th>
                                                    <th scope="col">Label</th>
                                                    <th scope="col">Condition</th>
                                                    <th scope="col"></th>
                                                </tr>
                                            </thead>
                                            <tbody id="detail.addin_vars.{{ key }}.cats">

                                                {% if val.cats %}

                                                    {% for k_cat, v_cat in val.cats.items() %}

                                                        <tr id="detail.addin_vars.{{ key }}.cats.{{ k_cat }}.row">
                                                            <td width="10%"><input type="text" class="form-control" id="detail.addin_vars.{{ key }}.cats.{{ k_cat }}.val"
                                                                   name="detail.addin_vars.{{ key }}.cats.{{ k_cat }}.val" value="{{ v_cat.val }}" placeholder="" aria-label=""></td>

                                                            <td width="30%"><input type="text" class="form-control" id="detail.addin_vars.{{ key }}.cats.{{ k_cat }}.lbl"
                                                                   name="detail.addin_vars.{{ key }}.cats.{{ k_cat }}.lbl" value="{{ v_cat.lbl }}" placeholder="" aria-label=""></td>

                                                            <td width="55%"><input type="text" class="form-control" id="detail.addin_vars.{{ key }}.cats.{{ k_cat }}.condition"
                                                                   name="detail.addin_vars.{{ key }}.cats.{{ k_cat }}.condition" value="{{ v_cat.condition }}" placeholder="" aria-label=""></td>

                                                            <td width="5%"><button type="button" class="btn btn-outline-danger" onclick="Del_variable_cat('detail.addin_vars.{{ key }}.cats.{{ k_cat }}.row');">X</button></td>
                                                        </tr>

                                                    {% endfor %}

                                                {% else %}

<!--                                                    <tr>-->
<!--                                                        <td>=></td>-->
<!--                                                        <td>Add value</td>-->
<!--                                                        <td></td>-->
<!--                                                        <td><=</td>-->
<!--                                                    </tr>-->

                                                {% endif %}

                                            </tbody>
                                        </table>

                                    </div>

                                    <div class="col-sm-12 col-xl-6">
                                        <div class="bg-light rounded h-100 p-1 ">
                                            <button type="button" class="btn btn-outline-primary" onclick="Add_variable_cat('detail.addin_vars.{{ key }}.cats');">+</button>
                                        </div>
                                    </div>

                                    <hr>
                                </div>


                            {% endfor %}

                        </div>

                        <div class="bg-light rounded h-100 p-4">
                            <div class="d-flex align-items-center justify-content-between mb-0">
                                <button type="button" class="btn btn-outline-primary py-3 w-25" onclick="Add_variable('group_addin_vars');">Add variable</button>
                                <input class="btn btn-primary py-3 w-25" type="submit" id="submit_add_vars" value="Submit add variables" onclick="fnc_submit('add_vars', false)">
                            </div>
                        </div>

                    </form>

                </div>

                <div class="tab-pane fade" id="nav-topline" role="tabpanel" aria-labelledby="nav-topline-tab">
<!--                    this is topline-->

                    <form id="form_topline" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">
                        <input type="hidden" id='output_topline' name="output">

                        <input type="hidden" id='detail.topline_design.is_display_pct_sign' name="detail.topline_design.is_display_pct_sign" value="{{ prj.detail.topline_design.is_display_pct_sign }}">

                        <input type="hidden" id='detail.topline_design.is_jar_scale_3' name="detail.topline_design.is_jar_scale_3" value="{{ prj.detail.topline_design.is_jar_scale_3 }}">

                        <div class="row g-0 p-4">

                            <div class="col-sm-12 col-xl-6">
                                <div class="bg-light rounded h-100 p-1">
                                    <div class="form-check form-switch">

                                        <input class="form-check-input" type="checkbox" role="switch"
                                                   id="cbx_is_display_pct_sign" onclick="cbxClick(this, 'detail.topline_design.is_display_pct_sign');">
                                        <label class="form-check-label" for="cbx_is_display_pct_sign">Display percentage sign(%)</label>

                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-12 col-xl-6">
                                <div class="bg-light rounded h-100 p-1">
                                    <div class="form-check form-switch">

                                        <input class="form-check-input" type="checkbox" role="switch"
                                                   id="cbx_is_jar_scale_3" onclick="cbxClick(this, 'detail.topline_design.is_jar_scale_3');">
                                        <label class="form-check-label" for="cbx_is_jar_scale_3">Run JAR mean base on scale 3</label>

                                    </div>
                                </div>
                            </div>

                        </div>

                        <div class="bg-light rounded h-100 p-4">
                            <div class="accordion accordion-flush" id="accordionFlushExample">
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="flush-headingOne">
                                        <button class="accordion-button" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#flush-collapseOne"
                                            aria-expanded="true" aria-controls="flush-collapseOne">
                                            <b>Header</b>
                                        </button>
                                    </h2>

                                    <div id="flush-collapseOne" class="accordion-collapse collapse show"
                                        aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample">
                                        <div class="accordion-body">
<!--                                            topline header-->
                                            <div class="table-responsive p-1">
                                                <table class="table text-start align-middle table-bordered table-hover mb-0">
                                                    <thead>
                                                        <tr class="text-dark">
                                                            <th scope="col">Name</th>
                                                            <th scope="col">Label</th>
                                                            <th scope="col">Hidden categories</th>
                                                            <th scope="col"></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="detail.topline_design.header">

                                                        {% if prj.detail.topline_design.header %}

                                                            {% for k_hd, v_hd in prj.detail.topline_design.header.items() %}

                                                                <tr id="detail.topline_design.header.{{ k_hd }}.row">
                                                                    <td width="40%"><input type="text" class="form-control" id="detail.topline_design.header.{{ k_hd }}.name"
                                                                       name="detail.topline_design.header.{{ k_hd }}.name" value="{{ v_hd.name }}"></td>

                                                                    <td width="20%"><input type="text" class="form-control" id="detail.topline_design.header.{{ k_hd }}.lbl"
                                                                       name="detail.topline_design.header.{{ k_hd }}.lbl" value="{{ v_hd.lbl }}"></td>

                                                                    <td width="35%"><input type="text" class="form-control" id="detail.topline_design.header.{{ k_hd }}.hidden_cats"
                                                                       name="detail.topline_design.header.{{ k_hd }}.hidden_cats" value="{{ v_hd.hidden_cats }}"></td>

                                                                    <td width="5%"><button type="button" class="btn btn-outline-danger"
                                                                       id="detail.topline_design.header.{{ k_hd }}.btn_del"
                                                                       onclick="Del_topline_header_item('detail.topline_design.header.{{ k_hd }}.row');">X</button></td>
                                                                </tr>

                                                            {% endfor %}

                                                        {% endif %}

                                                    </tbody>
                                                </table>
                                            </div>

                                            <div class="d-flex align-items-center justify-content-between p-1">
                                                <button type="button" class="btn btn-outline-primary" onclick="Add_topline_header_item('detail.topline_design.header');">+</button>
                                                <button type="button" class="btn btn-outline-primary" onclick="showDialog('dialog_bulkup_topline_header')">Bulk-up header</button>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="flush-headingTwo">
                                        <button class="accordion-button collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#flush-collapseTwo"
                                            aria-expanded="false" aria-controls="flush-collapseTwo">
                                            <b>Side axis</b>
                                        </button>
                                    </h2>
                                    <div id="flush-collapseTwo" class="accordion-collapse collapse"
                                        aria-labelledby="flush-headingTwo" data-bs-parent="#accordionFlushExample">
                                        <div class="accordion-body">
<!--                                            topline side axis-->

                                            <div class="bg-light rounded h-100 p-2" id="group_topline_side_items">

                                                {% if prj.detail.topline_design.side %}

                                                    {% for key, val in prj.detail.topline_design.side.items() %}

                                                        <div class="row g-0 p-2" id="detail.topline_design.side.{{ key }}">

                                                            <div class="d-flex align-items-center justify-content-between p-1">
                                                                <h6 class="mb-1">#{{ key }}</h6>
                                                                <button type="button" class="btn btn-outline-danger" onclick="Del_topline_side_item('detail.topline_design.side.{{ key }}', 'group_topline_side_items');">Delete</button>
                                                            </div>

                                                            <div class="col-sm-12 col-xl-6">
                                                                <div class="form-floating p-1">
                                                                    <input type="text" class="form-control" id="detail.topline_design.side.{{ key }}.group_lbl"
                                                                           name="detail.topline_design.side.{{ key }}.group_lbl" value="{{ val.group_lbl }}">
                                                                    <label for="detail.topline_design.side.{{ key }}.group_lbl">Group</label>
                                                                </div>
                                                            </div>

                                                            <div class="col-sm-12 col-xl-6">
                                                                <div class="form-floating p-1">
                                                                    <input type="text" class="form-control" id="detail.topline_design.side.{{ key }}.name"
                                                                           name="detail.topline_design.side.{{ key }}.name" value="{{ val.name }}">
                                                                    <label for="detail.topline_design.side.{{ key }}.name">Name</label>
                                                                </div>
                                                            </div>

                                                            <div class="col-sm-12 col-xl-6">
                                                                <div class="form-floating p-1">
                                                                    <input type="text" class="form-control" id="detail.topline_design.side.{{ key }}.lbl"
                                                                           name="detail.topline_design.side.{{ key }}.lbl" value="{{ val.lbl }}">
                                                                    <label for="detail.topline_design.side.{{ key }}.lbl">Label</label>
                                                                </div>
                                                            </div>

                                                            <div class="col-sm-12 col-xl-6">
                                                                <div class="form-floating p-1">
                                                                    <select class="form-select" id="detail.topline_design.side.{{ key }}.type"
                                                                            name="detail.topline_design.side.{{ key }}.type"
                                                                            onchange="topline_side_type(this);">

                                                                        {% for _type in ['OL', 'JR', 'FC', 'SA', 'MA', 'NUM'] %}

                                                                            {% if val.type == _type %}
                                                                                <option selected value="{{ _type }}">{{ _type }}</option>
                                                                            {% else %}
                                                                                <option value="{{ _type }}">{{ _type }}</option>
                                                                            {% endif %}

                                                                        {% endfor %}

                                                                    </select>
                                                                    <label for="detail.topline_design.side.{{ key }}.type">Type</label>
                                                                </div>
                                                            </div>

                                                            <div class="col-sm-12 col-xl-6">
                                                                <div class="form-floating p-1">

                                                                    <div class="form-check form-check-inline form-switch">
                                                                        <input class="form-check-input" type="checkbox" role="switch"
                                                                               id="detail.topline_design.side.{{ key }}.t2b"
                                                                               name="detail.topline_design.side.{{ key }}.t2b"
                                                                               value="{{ val.t2b }}"
                                                                               onclick="cbxClick(this, 'detail.topline_design.side.{{ key }}.t2b');">
                                                                        <label class="form-check-label" for="detail.topline_design.side.{{ key }}.t2b">T2B</label>
                                                                    </div>
                                                                    <div class="form-check form-check-inline form-switch">
                                                                        <input class="form-check-input" type="checkbox" role="switch"
                                                                               id="detail.topline_design.side.{{ key }}.b2b"
                                                                               name="detail.topline_design.side.{{ key }}.b2b"
                                                                               value="{{ val.b2b }}"
                                                                               onclick="cbxClick(this, 'detail.topline_design.side.{{ key }}.b2b');">
                                                                        <label class="form-check-label" for="detail.topline_design.side.{{ key }}.b2b">B2B</label>
                                                                    </div>
                                                                    <div class="form-check form-check-inline form-switch">
                                                                        <input class="form-check-input" type="checkbox" role="switch"
                                                                               id="detail.topline_design.side.{{ key }}.mean"
                                                                               name="detail.topline_design.side.{{ key }}.mean"
                                                                               value="{{ val.mean }}"
                                                                               onclick="cbxClick(this, 'detail.topline_design.side.{{ key }}.mean');">
                                                                        <label class="form-check-label" for="detail.topline_design.side.{{ key }}.mean">Mean</label>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div class="col-sm-12 col-xl-6">
                                                                <div class="form-floating p-1">

                                                                    <div class="form-check form-check-inline form-switch">
                                                                        <input class="form-check-input" type="checkbox" role="switch"
                                                                               id="detail.topline_design.side.{{ key }}.is_count"
                                                                               name="detail.topline_design.side.{{ key }}.is_count"
                                                                               value="{{ val.is_count }}"
                                                                               onclick="cbxClick(this, 'detail.topline_design.side.{{ key }}.is_count');">
                                                                        <label class="form-check-label" for="detail.topline_design.side.{{ key }}.is_count">Display count</label>
                                                                    </div>
                                                                    <div class="form-check form-check-inline form-switch">
                                                                        <input class="form-check-input" type="checkbox" role="switch"
                                                                               id="detail.topline_design.side.{{ key }}.is_corr"
                                                                               name="detail.topline_design.side.{{ key }}.is_corr"
                                                                               value="{{ val.is_corr }}"
                                                                               onclick="cbxClick(this, 'detail.topline_design.side.{{ key }}.is_corr');">
                                                                        <label class="form-check-label" for="detail.topline_design.side.{{ key }}.is_corr">Correlation</label>
                                                                    </div>
                                                                    <div class="form-check form-check-inline form-switch">
                                                                        <input class="form-check-input" type="checkbox" role="switch"
                                                                               id="detail.topline_design.side.{{ key }}.is_ua"
                                                                               name="detail.topline_design.side.{{ key }}.is_ua"
                                                                               value="{{ val.is_ua }}"
                                                                               onclick="cbxClick(this, 'detail.topline_design.side.{{ key }}.is_ua');">
                                                                        <label class="form-check-label" for="detail.topline_design.side.{{ key }}.is_ua">U&A</label>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div class="col-sm-12 col-xl-6">
                                                                <div class="form-floating p-1">
                                                                    <input type="text" class="form-control" id="detail.topline_design.side.{{ key }}.ma_cats"
                                                                           name="detail.topline_design.side.{{ key }}.ma_cats" value="{{ val.ma_cats }}">
                                                                    <label for="detail.topline_design.side.{{ key }}.ma_cats">MA Categories</label>
                                                                </div>
                                                            </div>

                                                            <div class="col-sm-12 col-xl-6">
                                                                <div class="form-floating p-1">
                                                                    <input type="text" class="form-control" id="detail.topline_design.side.{{ key }}.hidden_cats"
                                                                           name="detail.topline_design.side.{{ key }}.hidden_cats" value="{{ val.hidden_cats }}">
                                                                    <label for="detail.topline_design.side.{{ key }}.hidden_cats">Hidden categories</label>
                                                                </div>
                                                            </div>

                                                            <hr>
                                                        </div>

                                                    {% endfor %}

                                                {% endif %}

                                            </div>

                                            <div class="d-flex align-items-center justify-content-between p-2">
                                                <button type="button" class="btn btn-outline-primary" onclick="Add_topline_side_item('group_topline_side_items');">+</button>
                                                <button type="button" class="btn btn-outline-primary" onclick="showDialog('dialog_bulkup_topline_side')">Bulk-up side</button>
                                            </div>

                                        </div>

                                    </div>
                                </div>

                            </div>
                        </div>


                        <div class="bg-light rounded h-100 p-4">
                            <div class="d-flex align-items-center justify-content-end mb-4">
                                <input class="btn btn-primary py-3 w-25" type="submit" value="Submit topline" onclick="fnc_submit('topline', false)">
                            </div>
                        </div>
                    </form>

<!--                    dialog for bulkup topline header-->
                    <dialog id="dialog_bulkup_topline_header" class="col-sm-12 col-xl-6">

                        <div class="bg-light rounded h-100 p-4">

                            <div class="d-flex align-items-center justify-content-between mb-2">
                                <h5 class="mb-2">Bulk-up topline header</h5>
                            </div>

                            <form id="form_bulkup_topline_header" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">

                                <input type="hidden" id='output_bulkup_topline_header' name="output">

                                <div class="align-items-center justify-content-between mb-2">

                                    <div class="form-floating">
                                        <textarea class="form-control" placeholder="Leave a input here"
                                            id="floatingTextarea_bulkup_topline_header" name="detail.topline_design.header" style="height: 500px"></textarea>
                                        <label for="floatingTextarea_bulkup_topline_header">Leave an input here</label>
                                    </div>

                                </div>

                                <div class="d-flex align-items-center justify-content-end mb-2">
                                    <button type="button" class="btn btn-secondary py-3 w-25" onclick="closeDialog('dialog_bulkup_topline_header')">Close</button>
                                    <input class="btn btn-primary py-3 w-25" type="submit" value="Submit" id="submit_bulkup_topline_header" onclick="fnc_submit('bulkup_topline_header', true)">
                                </div>

                            </form>

                        </div>

                    </dialog>

                    <!--                    dialog for bulkup topline side-->
                    <dialog id="dialog_bulkup_topline_side" class="col-sm-12 col-xl-6">

                        <div class="bg-light rounded h-100 p-4">

                            <div class="d-flex align-items-center justify-content-between mb-2">
                                <h5 class="mb-2">Bulk-up topline side</h5>
                            </div>

                            <form id="form_bulkup_topline_side" action="/msn-prj/update/{{ prj.id }}" method="post" enctype="multipart/form-data">

                                <input type="hidden" id='output_bulkup_topline_side' name="output">

                                <div class="align-items-center justify-content-between mb-2">

                                    <div class="form-floating">
                                        <textarea class="form-control" placeholder="Leave a input here"
                                            id="floatingTextarea_bulkup_topline_side" name="detail.topline_design.side" style="height: 500px"></textarea>
                                        <label for="floatingTextarea_bulkup_topline_side">Leave an input here</label>
                                    </div>

                                </div>

                                <div class="d-flex align-items-center justify-content-end mb-2">
                                    <button type="button" class="btn btn-secondary py-3 w-25" onclick="closeDialog('dialog_bulkup_topline_side')">Close</button>
                                    <input class="btn btn-primary py-3 w-25" type="submit" value="Submit" id="submit_bulkup_topline_side" onclick="fnc_submit('bulkup_topline_side', true)">
                                </div>

                            </form>

                        </div>

                    </dialog>

                </div>

                <div class="tab-pane fade" id="nav-data" role="tabpanel" aria-labelledby="nav-data-tab">
<!--                    this is data-->

                    <form id="form_data_clear" action="/msn-prj/data_clear/{{ prj.id }}" method="post" enctype="multipart/form-data">

                        <div class="row g-4 p-4">

                            <div class="col-sm-12 col-xl-4">
                                <h5>Screener = {{ prj.lenOfScr }} res</h5>
                            </div>

                            <div class="col-sm-12 col-xl-4">
                                <h5>Main = {{ prj.lenOfMain }} res</h5>
                            </div>

                            <div class="col-sm-12 col-xl-4">
                                <input class="btn btn-outline-danger py-3 w-100" type="submit" value="Clear data" onclick="fnc_submit_clear_data()">
                            </div>

                        </div>

                    </form>

                    <hr>

                    <form id="form_data_upload" action="/msn-prj/data_upload/{{ prj.id }}" method="post" enctype="multipart/form-data">

                        <h3 class="bg-light rounded h-100 p-2">Upload Rawdata</h3>

                        <div class="row g-4 p-4">

                            <div class="col-sm-12 col-xl-4">
                                <label for="file_scr" class="form-label">Choose screener file</label>
                                <input class="form-control" type="file" id="file_scr" name="file_scr" multiple data-max="1" accept=".xlsx" value="">
                            </div>

                            <div class="col-sm-12 col-xl-4">
                                <label for="file_main" class="form-label">Choose main file</label>
                                <input class="form-control" type="file" id="file_main" name="file_main" multiple data-max="1" accept=".xlsx" value="">
                            </div>

                            <div class="col-sm-12 col-xl-4">
                                <input class="btn btn-primary py-3 w-100" type="submit" value="Upload data">
                            </div>

                        </div>

                    </form>

                    <hr>

                    <form id="form_data_export" action="/msn-prj/data_export/{{ prj.id }}" method="get" enctype="multipart/form-data">

                        <h3 class="bg-light rounded h-100 p-2">Export Data</h3>
                        <h6 class="bg-light rounded h-100 p-3">Excel file & stack sav & unstack sav</h6>

                        <div class="row g-4 p-4">

                            <div class="col-sm-12 col-xl-4">
                                <h7 >Please select the section to export data.<br/> It will take a several minute</h7>
                            </div>

                            <div class="col-sm-12 col-xl-4">
                                <div class="form-floating mb-2">

                                    <select class="form-select" id="export_section"
                                        aria-label="Floating label select example"
                                        name="export_section">

                                        <option selected value="-1">Select section</option>

                                        {% for key, val in prj.detail.sections.items() %}
                                            <option value="{{ key }}">{{ val.name }}</option>
                                        {% endfor %}

                                    </select>

                                    <label for="export_section">Please select the data section</label>

                                </div>
                            </div>

                            <div class="col-sm-12 col-xl-4">
                                <input class="btn btn-primary py-3 w-100 mb-2" type="submit" value="Export data" onclick="submit_export_data('form_data_export');">
                            </div>

                        </div>

                    </form>

                    <hr>

                    <h3 class="bg-light rounded h-100 p-2">Process Topline / Handcount</h3>

                    {% if not prj.sec_topline_exporter %}
                        <div class="alert alert-warning" role="alert">
                            The topline is not processed. Please choose the <b>topline section</b> -> click <b>process topline</b>.
                        </div>
                    {% endif %}

                    <div class="row g-4 p-4">

                        <div class="col-sm-12 col-xl-4">
                            <h7 >Please select the section to export topline. It will take a several minute</h7>
                        </div>

                        <div class="col-sm-12 col-xl-4">
                            <div class="form-floating mb-2">

                                <select class="form-select" id="export_tl_section"
                                    aria-label="Floating label select example"
                                    name="export_tl_section">

                                    <option selected value="-1">Select section</option>

                                    {% for key, val in prj.detail.sections.items() %}
                                        <option value="{{ key }}">{{ val.name }}</option>
                                    {% endfor %}

                                </select>

                                <label for="export_tl_section">Please select the topline section</label>

                            </div>
                        </div>

                        <div class="col-sm-12 col-xl-4">
                            <form id="form_topline_process" action="/msn-prj/topline_process/{{ prj.id }}" method="get" enctype="multipart/form-data">
                                <input type="hidden" value="" id="export_tl_section_1" name="export_section">
                                <input class="btn btn-primary py-3 w-100 mb-2" type="submit" value="Process topline" onclick="fnc_process_tl_submit(this, 'form_topline_process');">
                            </form>
                        </div>
                    </div>

                    {% if prj.sec_topline_exporter %}

                        {% for key, val in prj.sec_topline_exporter.items()  %}
                            <hr>

                            <h3 class="bg-light rounded h-100 p-2">Export {{ val }} Handcount</h3>

                            <div class="row g-4 p-4">

                                <div class="col-sm-12 col-xl-4">

                                </div>

                                <div class="col-sm-12 col-xl-4">

                                </div>

                                <div class="col-sm-12 col-xl-4">
                                    <form id="form_handcount_export" action="/msn-prj/handcount_export/{{ prj.id }}" method="get" enctype="multipart/form-data">
                                        <input type="hidden" value="{{ key }}" name="export_section">
                                        <input class="btn btn-primary py-3 w-100 mb-0" type="submit" value="{{ val }} handcount" onclick="fnc_tl_submit(this, 'form_handcount_export', 'Handcount');">
                                    </form>
                                </div>

                            </div>

                            <hr>

                            <h3 class="bg-light rounded h-100 p-2">Export {{ val }} Topline</h3>

                            <div class="row g-4 p-4">

                                <div class="col-sm-12 col-xl-4">
                                    <form id="form_topline_export_product" action="/msn-prj/topline_export_product/{{ prj.id }}" method="get" enctype="multipart/form-data">
                                        <input type="hidden" value="{{ key }}" name="export_section">
                                        <input class="btn btn-outline-primary py-3 w-100 mb-0" type="submit" value="{{ val }} product" onclick="fnc_tl_submit(this, 'form_topline_export_product', 'Topline Product Sheets');">
                                    </form>
                                </div>

                                <div class="col-sm-12 col-xl-4">
                                    <form id="form_topline_export_ua" action="/msn-prj/topline_export_ua_corr/{{ prj.id }}" method="get" enctype="multipart/form-data">
                                        <input type="hidden" value="{{ key }}" name="export_section">
                                        <input class="btn btn-outline-primary py-3 w-100 mb-0" type="submit" value="{{ val }} U&A + Correlation" onclick="fnc_tl_submit(this, 'form_topline_export_ua', 'Topline U&A + Correlation Sheets');">
                                    </form>
                                </div>

                                <div class="col-sm-12 col-xl-4">
                                    <form id="form_topline_export" action="/msn-prj/topline_export/{{ prj.id }}" method="get" enctype="multipart/form-data">
                                        <input type="hidden" value="{{ key }}" name="export_section">
                                        <input class="btn btn-primary py-3 w-100 mb-0" type="submit" value="{{ val }} full topline" onclick="fnc_tl_submit(this, 'form_topline_export', 'Full Topline');">
                                    </form>
                                </div>

                            </div>
                        {% endfor %}
                    {% endif %}















































                </div>

            </div>

        </div>

    </div>



    <script>
        window.addEventListener('load', function() {

            a = document.getElementById('detail.topline_design.is_display_pct_sign');
            b = document.getElementById('detail.topline_design.is_jar_scale_3');

            c = document.getElementById('cbx_is_display_pct_sign');
            d = document.getElementById('cbx_is_jar_scale_3');

            if (a.value == "True") {
                c.checked = true;
            }
            else {
                c.checked = false;
            }

            if (b.value == "True") {
                d.checked = true;
            }
            else {
                d.checked = false;
            }

<!--            name_tl_hd_total = document.getElementById('detail.topline_design.header.1.name');-->
<!--            lbl_tl_hd_total = document.getElementById('detail.topline_design.header.1.lbl');-->
<!--            hidden_cats_tl_hd_total = document.getElementById('detail.topline_design.header.1.hidden_cats');-->
<!--            bnt_tl_hd_total = document.getElementById('detail.topline_design.header.1.btn_del');-->

<!--            name_tl_hd_total.disabled = true;-->
<!--            lbl_tl_hd_total.disabled = true;-->
<!--            hidden_cats_tl_hd_total.disabled = true;-->
<!--            bnt_tl_hd_total.hidden = true;-->

            var elm_group_tl_side_items = document.getElementById('group_topline_side_items');

            for (idx in elm_group_tl_side_items.children)
            {
                child = elm_group_tl_side_items.children.item(idx);
                childID = child.id;

                arr = ['t2b', 'b2b', 'mean', 'is_count', 'is_corr', 'is_ua'];

                for(var i = 0; i < arr.length; i++){
                    childItem = document.getElementById(childID + "." + arr[i]);

                    a = childItem.value

                    if(childItem.value == "True")
                    {
                        childItem.checked = true;
                    }
                    else {
                        childItem.checked = false;
                    }
                }

            }



        });

        function cbxClick(cbx, elm_id){
            var elm = document.getElementById(elm_id);
            elm.value = cbx.checked;
        };

        setTimeout(() => {
            const err = document.getElementById('err');
            err.style.display = 'none';
        }, 3000);

        function showDialog(strID) {
            document.getElementById(strID).showModal();
        };

        function closeDialog(strID) {
            document.getElementById(strID).close();
        };

        function fnc_submit(strName, isBulkup){

            strForm = 'form_' + strName;
            strOutput = 'output_' + strName;

            isSubmit = confirm('Confirm update the ' + strName + '?');

            if (isSubmit == true) {

                document.getElementById(strForm).addEventListener('submit', (e) => {
                    e.preventDefault();

                    formData = new FormData(e.target);
                    data = Array.from(formData.entries()).reduce((memo, [key, value]) => ({
                        ...memo,
                        [key]: value,
                    }), {});


                    console.log(data);

                    jsonData = JSON.stringify(data);

                    if(isBulkup == true){

                        obj = JSON.parse(jsonData);

                        key = Object.keys(obj)[1];
                        val = obj[key];

                        lstVal = val.split('\n');

                        newJsonData = {"output": ""};

                        for(var i = 0; i < lstVal.length; i++){

                            if(lstVal[i].length > 0)
                            {
                                lstSubVal = lstVal[i].split('\t');

                                newJsonData[key + '.' + (i+1).toString()] = lstSubVal;
                            }
                        }

                        jsonData = JSON.stringify(newJsonData);
                    }

                    if(Object.keys(JSON.parse(jsonData)).length > 1) {

                        document.getElementById(strOutput).value = jsonData;
                        document.getElementById(strForm).submit();
                    }
                    else {
                        alert("Cannot submit null data!");

                    }

                });
            }
            else
            {
                document.getElementById(strForm).addEventListener('submit', (e) => {
                    e.preventDefault();

                });
            }

        };

        function Del_variable_cat(elm_id) {

            const cat = document.getElementById(elm_id);

            arr = elm_id.split(".");

            idx_cat = arr[4];
            strId = "detail.addin_vars." + arr[2] + ".cats.XXX";
            var bodyId = "detail.addin_vars." + arr[2] + ".cats";
            var count = document.getElementById(bodyId).children.length;

            for(var i = parseInt(idx_cat); i < count; i++) {

                itemParent = strId.replace("XXX", i.toString());
                nextItemParent = strId.replace("XXX", (i+1).toString());

                val = document.getElementById(itemParent + ".val");
                nextVal = document.getElementById(nextItemParent + ".val");
                val.value = nextVal.value;


                lbl = document.getElementById(itemParent + ".lbl");
                nextLbl = document.getElementById(nextItemParent + ".lbl");
                lbl.value = nextLbl.value;

                cond = document.getElementById(itemParent + ".condition");
                nextCond = document.getElementById(nextItemParent + ".condition");
                cond.value = nextCond.value;

            }

            removeItem = document.getElementById("detail.addin_vars." + arr[2] + ".cats." + count.toString() + ".row");
            removeItem.remove();

        };

        function Add_variable_cat(elm_id) {
            var count = document.getElementById(elm_id).children.length;

            var tbl_row = document.createElement("tr");
            tbl_row.id = elm_id + "." + (count + 1).toString() + ".row";

            var td_Value = document.createElement("td");
            td_Value.width = '10%';
            var txt_Value = document.createElement("input");
            txt_Value.type = "text";
            txt_Value.classList.add("form-control");
            txt_Value.id = elm_id + "." + (count + 1).toString() + ".val";
            txt_Value.name = elm_id + "." + (count + 1).toString() + ".val";
            td_Value.appendChild(txt_Value);

            var td_Label = document.createElement("td");
            td_Label.width = '30%';
            var txt_Label = document.createElement("input");
            txt_Label.type = "text";
            txt_Label.classList.add("form-control");
            txt_Label.id = elm_id + "." + (count + 1).toString() + ".lbl";
            txt_Label.name = elm_id + "." + (count + 1).toString() + ".lbl";
            td_Label.appendChild(txt_Label);

            var td_Condition = document.createElement("td");
            td_Condition.width = '55%';
            var txt_Condition = document.createElement("input");
            txt_Condition.type = "text";
            txt_Condition.classList.add("form-control");
            txt_Condition.id = elm_id + "." + (count + 1).toString() + ".condition";
            txt_Condition.name = elm_id + "." + (count + 1).toString() + ".condition";
            td_Condition.appendChild(txt_Condition);

            var td_Action = document.createElement("td");
            td_Action.width = '5%';
            var btn_del = document.createElement("input");
            btn_del.type = "button";
            btn_del.classList.add("btn", "btn-outline-danger");
            btn_del.value = "X";
            btn_del.onclick = function() { Del_variable_cat(tbl_row.id); };
            td_Action.appendChild(btn_del);

            tbl_row.appendChild(td_Value);
            tbl_row.appendChild(td_Label);
            tbl_row.appendChild(td_Condition);
            tbl_row.appendChild(td_Action);

            document.getElementById(elm_id).appendChild(tbl_row);
        };


        function Add_variable(group_id) {

            var count = document.getElementById(group_id).children.length;

            lastItemID = document.getElementById(group_id).children.item(count-1).id;
            lastKey = lastItemID.split(".")[2];

            newKey = parseInt(lastKey) + 1;

            var elm_var = document.createElement("div");
            elm_var.classList.add("row", "g-0", "p-4");
            elm_var.id = "detail.addin_vars." + newKey.toString();

            var div_header = document.createElement("div");
            var header = document.createElement("h6");
            var btn_header = document.createElement("input");

            div_header.classList.add("d-flex", "align-items-center", "justify-content-between", "p-1");
            header.classList.add("mb-1");
            btn_header.classList.add("btn", "btn-outline-danger");

            header.innerHTML = "#" + newKey.toString();

            btn_header.type = "button";
            btn_header.value = "Delete";
            btn_header.onclick = function() { Del_variable(elm_var.id); };

            div_header.appendChild(header);
            div_header.appendChild(btn_header);
            elm_var.appendChild(div_header);

            var div_name_1 = document.createElement("div");
            var div_name_2 = document.createElement("div");
            var div_name_3 = document.createElement("div");
            var input_name = document.createElement("input");
            var label_name = document.createElement("label");

            div_name_1.classList.add("col-sm-12", "col-xl-6");
            div_name_2.classList.add("bg-light", "rounded", "h-100", "p-1");
            div_name_3.classList.add("form-floating", "mb-0");
            input_name.classList.add("form-control");

            input_name.type = "text";
            input_name.id = "detail.addin_vars." + newKey.toString() + ".name";
            input_name.name = input_name.id;

            label_name.htmlFor = input_name.id;
            label_name.innerHTML = "Name";

            div_name_1.appendChild(div_name_2);
            div_name_2.appendChild(div_name_3);
            div_name_3.appendChild(input_name);
            div_name_3.appendChild(label_name);
            elm_var.appendChild(div_name_1);

            var div_lbl_1 = document.createElement("div");
            var div_lbl_2 = document.createElement("div");
            var div_lbl_3 = document.createElement("div");
            var input_lbl = document.createElement("input");
            var label_lbl = document.createElement("label");

            div_lbl_1.classList.add("col-sm-12", "col-xl-6");
            div_lbl_2.classList.add("bg-light", "rounded", "h-100", "p-1");
            div_lbl_3.classList.add("form-floating", "mb-0");
            input_lbl.classList.add("form-control");

            input_lbl.type = "text";
            input_lbl.id = "detail.addin_vars." + newKey.toString() + ".lbl";
            input_lbl.name = input_lbl.id;

            label_lbl.htmlFor = input_lbl.id;
            label_lbl.innerHTML = "Label";

            div_lbl_1.appendChild(div_lbl_2);
            div_lbl_2.appendChild(div_lbl_3);
            div_lbl_3.appendChild(input_lbl);
            div_lbl_3.appendChild(label_lbl);
            elm_var.appendChild(div_lbl_1);

            var table_div = document.createElement("div");
            var table_tbl = document.createElement("table");
            var table_thead = document.createElement("thead");
            var table_thead_row = document.createElement("tr");
            var table_th1 = document.createElement("th");
            var table_th2 = document.createElement("th");
            var table_th3 = document.createElement("th");
            var table_th4 = document.createElement("th");
            var table_tbody = document.createElement("tbody");

            table_div.classList.add("table-responsive", "p-1");
            table_tbl.classList.add("table", "text-start", "align-middle", "table-bordered", "table-hover", "mb-0");
            table_thead_row.classList.add("text-dark");

            table_th1.scope = "col";
            table_th2.scope = "col";
            table_th3.scope = "col";
            table_th4.scope = "col";

            table_th1.innerHTML = "Value";
            table_th2.innerHTML = "Label";
            table_th3.innerHTML = "Condition";
            table_th4.innerHTML = "";

            table_tbody.id = "detail.addin_vars." + newKey.toString() + ".cats"

            table_div.appendChild(table_tbl);
            table_tbl.appendChild(table_thead);
            table_tbl.appendChild(table_tbody);
            table_thead.appendChild(table_thead_row);
            table_thead_row.appendChild(table_th1);
            table_thead_row.appendChild(table_th2);
            table_thead_row.appendChild(table_th3);
            table_thead_row.appendChild(table_th4);
            elm_var.appendChild(table_div);

            var btn_div_1 = document.createElement("div");
            var btn_div_2 = document.createElement("div");
            var btn_input = document.createElement("input");

            btn_div_1.classList.add("col-sm-12", "col-xl-6");
            btn_div_2.classList.add("bg-light", "rounded", "h-100", "p-1");
            btn_input.classList.add("btn", "btn-outline-primary");

            btn_input.type = "button";
            btn_input.value = "+";
            btn_input.onclick = function() { Add_variable_cat(table_tbody.id); };

            btn_div_1.appendChild(btn_div_2);
            btn_div_2.appendChild(btn_input);
            elm_var.appendChild(btn_div_1);

            elm_var.appendChild(document.createElement("hr"))

            document.getElementById(group_id).appendChild(elm_var);
        };

        function Del_variable(elm_id, group_id){

            isDel = confirm('Confirm delete variable #' + elm_id.split(".")[2] + "?");

            if(isDel == true){
                var elm_remove = document.getElementById(elm_id);
                elm_remove.remove();
            }

        };

        function Add_topline_header_item(elm_id){

            var elm = document.getElementById(elm_id);
            var count = elm.children.length;

            lastItemID = elm.children.item(count-1).id;
            arr_lastItemID = lastItemID.split('.');

            newItemID = parseInt(arr_lastItemID[arr_lastItemID.indexOf('row') - 1]) + 1;
            strNewItemID = "detail.topline_design.header." + newItemID.toString();

            tr = document.createElement("tr");
            td_name = document.createElement("td");
            td_lbl = document.createElement("td");
            td_hid = document.createElement("td");
            td_btn = document.createElement("td");

            tr.id = strNewItemID + ".row";

            td_name.width = "40%";
            td_lbl.width = "20%";
            td_hid.width = "35%";
            td_btn.width = "5%";

            ipt_name = document.createElement("input");
            ipt_lbl = document.createElement("input");
            ipt_hid = document.createElement("input");
            ipt_btn = document.createElement("input");

            ipt_name.type = "text"
            ipt_name.classList.add("form-control");
            ipt_name.id = strNewItemID + ".name";
            ipt_name.name = ipt_name.id

            ipt_lbl.type = "text"
            ipt_lbl.classList.add("form-control");
            ipt_lbl.id = strNewItemID + ".lbl";
            ipt_lbl.name = ipt_lbl.id

            ipt_hid.type = "text"
            ipt_hid.classList.add("form-control");
            ipt_hid.id = strNewItemID + ".hidden_cats";
            ipt_hid.name = ipt_hid.id

            ipt_btn.type = "button"
            ipt_btn.classList.add("btn", "btn-outline-danger");
            ipt_btn.id = strNewItemID + ".btn_del";
            ipt_btn.value = "X";
            ipt_btn.setAttribute('onclick', "Del_topline_header_item('" + tr.id + "')");

            tr.appendChild(td_name);
            tr.appendChild(td_lbl);
            tr.appendChild(td_hid);
            tr.appendChild(td_btn);

            td_name.appendChild(ipt_name);
            td_lbl.appendChild(ipt_lbl);
            td_hid.appendChild(ipt_hid);
            td_btn.appendChild(ipt_btn);

            elm.appendChild(tr);

        };

        function Del_topline_header_item(elm_id){

            isDel = confirm('Confirm delete variable #' + elm_id + "?");

            if(isDel == true){
                var elm = document.getElementById(elm_id);
                elm.remove();
            }
        };

        function Add_topline_side_item(elm_id) {

            var elm = document.getElementById(elm_id);
            var count = elm.children.length;

            lastItemID = elm.children.item(count-1).id;
            arr_lastItemID = lastItemID.split('.');

            newItemID = parseInt(arr_lastItemID[arr_lastItemID.length - 1]) + 1;
            strNewItemID = "detail.topline_design.side." + newItemID.toString();

            sideItem = document.createElement("div");
            sideItem.classList.add("row", "g-0", "p-2");
            sideItem.id = strNewItemID;

            div1 = document.createElement("div");
            div1.classList.add("d-flex", "align-items-center", "justify-content-between", "p-1");

            div1_h6 = document.createElement("h6");
            div1_h6.classList.add("mb-1");
            div1_h6.innerHTML = "#" + newItemID.toString();

            btn_del_item = document.createElement("input");
            btn_del_item.type = "button"
            btn_del_item.classList.add("btn", "btn-outline-danger");
            btn_del_item.value = "Delete";
            btn_del_item.setAttribute('onclick', "Del_topline_side_item('" + sideItem.id + "')");

            sideItem.appendChild(div1);
            div1.appendChild(div1_h6);
            div1.appendChild(btn_del_item);

            arr = ['group_lbl', 'name', 'lbl', 'type', 't2b|b2b|mean', 'is_count|is_corr|is_ua', 'ma_cats', 'hidden_cats'];
            for(var i = 0; i < arr.length; i++)
            {
                div_sub1 = document.createElement("div");
                div_sub1.classList.add("col-sm-12", "col-xl-6");

                div_sub2 = document.createElement("div");
                div_sub2.classList.add("form-floating", "p-1");

                if (arr[i] == 'group_lbl' || arr[i] == 'name' || arr[i] == 'lbl' || arr[i] == 'ma_cats' || arr[i] == 'hidden_cats') {

                    ipt_item = document.createElement("input");
                    ipt_item.type = "text";
                    ipt_item.classList.add("form-control");
                    ipt_item.id = strNewItemID + "." + arr[i];
                    ipt_item.name = ipt_item.id;

                    label_item = document.createElement("label");
                    label_item.htmlFor = ipt_item.id;

                    if (arr[i] == 'group_lbl') {
                        label_item.innerHTML = "Group";
                    }
                    else if(arr[i] == 'name') {
                        label_item.innerHTML = "Name";
                    }
                    else if(arr[i] == 'lbl') {
                        label_item.innerHTML = "Label";
                    }
                    else if(arr[i] == 'ma_cats') {
                        label_item.innerHTML = "MA Categories";
                    }
                    else if(arr[i] == 'hidden_cats') {
                        label_item.innerHTML = "Hidden categories";
                    }


                }
                else if (arr[i] == 'type') {

                    ipt_item = document.createElement("select");
                    ipt_item.classList.add("form-select");
                    ipt_item.id = strNewItemID + "." + arr[i];
                    ipt_item.name = ipt_item.id;
                    ipt_item.setAttribute('onchange', "topline_side_type(this);");

                    arr_sel_item = ['OL', 'JR', 'FC', 'SA', 'MA', 'NUM'];
                    for(var j = 0; j < arr_sel_item.length; j++) {
                        sel_item = document.createElement("option");
                        sel_item.value = arr_sel_item[j];
                        sel_item.innerHTML = sel_item.value
                        ipt_item.appendChild(sel_item);
                    }

                    label_item = document.createElement("label");
                    label_item.htmlFor = ipt_item.id;
                    label_item.innerHTML = "Type";

                }
                else if (arr[i] == 't2b|b2b|mean' || 'is_count|is_corr|is_ua') {

                    sub_arr = arr[i].split('|');

                    for(var j = 0; j < sub_arr.length; j++) {
                        div_sub3 = document.createElement("div");
                        div_sub3.classList.add("form-check", "form-check-inline", "form-switch");

                        ipt_item = document.createElement("input");
                        ipt_item.type = "checkbox";
                        ipt_item.classList.add("form-check-input");
                        ipt_item.setAttribute('role', "switch");
                        ipt_item.id = strNewItemID + "." + sub_arr[j];
                        ipt_item.name = ipt_item.id;
                        ipt_item.setAttribute('onclick', "cbxClick(this, '" + ipt_item.id + "');");

                        label_item = document.createElement("label");
                        label_item.htmlFor = ipt_item.id;

                        if (sub_arr[j] == 't2b') {
                            label_item.innerHTML = "T2B";
                        }
                        else if(sub_arr[j] == 'b2b') {
                            label_item.innerHTML = "B2B";
                        }
                        else if(sub_arr[j] == 'mean') {
                            label_item.innerHTML = "Mean";
                        }
                        else if(sub_arr[j] == 'is_count') {
                            label_item.innerHTML = "Display count";
                        }
                        else if(sub_arr[j] == 'is_corr') {
                            label_item.innerHTML = "Correlation";
                        }
                        else if(sub_arr[j] == 'is_ua') {
                            label_item.innerHTML = "U&A";
                        }

                        div_sub3.appendChild(ipt_item);
                        div_sub3.appendChild(label_item);
                        div_sub2.appendChild(div_sub3);
                    }

                }

                sideItem.appendChild(div_sub1);
                div_sub1.appendChild(div_sub2);

                if (arr[i] != 't2b|b2b|mean' && arr[i] != 'is_count|is_corr|is_ua') {
                    div_sub2.appendChild(ipt_item);
                    div_sub2.appendChild(label_item);
                }

            }

            sideItem.appendChild(document.createElement("hr"));

            elm.appendChild(sideItem);

        };

        function Del_topline_side_item(elm_id, group_id){

            isDel = confirm('Confirm delete variable #' + elm_id.split(".")[3] + "?");

            if(isDel == true){
                var elm_remove = document.getElementById(elm_id);
                elm_remove.remove();
            }
        };

        function topline_side_type(sel) {
            itemID = (sel.id).replace("type", "");

            elm_t2b = document.getElementById(itemID + "t2b");
            elm_b2b = document.getElementById(itemID + "b2b");
            elm_mean = document.getElementById(itemID + "mean");

            elm_ma_cats = document.getElementById(itemID + "ma_cats");
            elm_hidden_cats = document.getElementById(itemID + "hidden_cats");

            elm_is_count = document.getElementById(itemID + "is_count");
            elm_is_corr = document.getElementById(itemID + "is_corr");
            elm_is_ua = document.getElementById(itemID + "is_ua");

            selVal = sel.value;
            switch(selVal) {
                case 'OL':
                    elm_t2b.checked = true;
                    elm_b2b.checked = true;
                    elm_mean.checked = true;

                    elm_is_count.checked = false;
                    elm_is_corr.checked = true;
                    elm_is_ua.checked = false;

                    elm_t2b.value = "true";
                    elm_b2b.value = "true";
                    elm_mean.value = "true";

                    elm_is_count.value = "false";
                    elm_is_corr.value = "true";
                    elm_is_ua.value = "false";

                    elm_ma_cats.value = "";
                    elm_hidden_cats.value = "";

                    break;

                case 'JR':
                    elm_t2b.checked = true;
                    elm_b2b.checked = true;
                    elm_mean.checked = true;

                    elm_is_count.checked = false;
                    elm_is_corr.checked = false;
                    elm_is_ua.checked = false;

                    elm_t2b.value = "true";
                    elm_b2b.value = "true";
                    elm_mean.value = "true";

                    elm_is_count.value = "false";
                    elm_is_corr.value = "false";
                    elm_is_ua.value = "false";

                    elm_ma_cats.value = "";
                    elm_hidden_cats.value = "";

                    break;

                case 'FC':

                    elm_t2b.checked = false;
                    elm_b2b.checked = false;
                    elm_mean.checked = false;

                    elm_is_count.checked = false;
                    elm_is_corr.checked = false;
                    elm_is_ua.checked = false;

                    elm_t2b.value = "false";
                    elm_b2b.value = "false";
                    elm_mean.value = "false";

                    elm_is_count.value = "false";
                    elm_is_corr.value = "false";
                    elm_is_ua.value = "false";

                    elm_ma_cats.value = "";
                    elm_hidden_cats.value = "";

                    break;

                case 'SA':

                    elm_t2b.checked = false;
                    elm_b2b.checked = false;
                    elm_mean.checked = false;

                    elm_is_count.checked = false;
                    elm_is_corr.checked = false;
                    elm_is_ua.checked = true;

                    elm_t2b.value = "false";
                    elm_b2b.value = "false";
                    elm_mean.value = "false";

                    elm_is_count.value = "false";
                    elm_is_corr.value = "false";
                    elm_is_ua.value = "true";

                    elm_ma_cats.value = "";
                    elm_hidden_cats.value = "";

                    break;

                case 'MA':

                    elm_t2b.checked = false;
                    elm_b2b.checked = false;
                    elm_mean.checked = false;

                    elm_is_count.checked = false;
                    elm_is_corr.checked = false;
                    elm_is_ua.checked = true;

                    elm_t2b.value = "false";
                    elm_b2b.value = "false";
                    elm_mean.value = "false";

                    elm_is_count.value = "false";
                    elm_is_corr.value = "false";
                    elm_is_ua.value = "true";

                    break;

                case 'NUM':

                    elm_t2b.checked = false;
                    elm_b2b.checked = false;
                    elm_mean.checked = false;

                    elm_is_count.checked = false;
                    elm_is_corr.checked = false;
                    elm_is_ua.checked = true;

                    elm_t2b.value = "false";
                    elm_b2b.value = "false";
                    elm_mean.value = "false";

                    elm_is_count.value = "false";
                    elm_is_corr.value = "false";
                    elm_is_ua.value = "true";

                    elm_ma_cats.value = "";
                    elm_hidden_cats.value = "";

                    break;

            }

        };

        function fnc_submit_clear_data(){
            isSubmit = confirm('Confirm clear data?');

            elm = document.getElementById("form_data_clear")

            if (isSubmit == true) {

                elm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    elm.submit();
                });
            }
            else
            {
                elm.addEventListener('submit', (e) => {
                    e.preventDefault();
                });
            }
        };

        function submit_export_data(form_id) {

            form_elm = document.getElementById(form_id);

            selSection = document.getElementById("export_section");

            if(selSection.value == '-1'){
                alert("Please select the export section!");
                form_elm.addEventListener('submit', (e) => {
                    e.preventDefault();
                });
            }
            else {
                isConfirm = confirm('Confirm export data for ' + selSection.options[selSection.selectedIndex].text + '?');

                if(isConfirm == true){

                    form_elm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        form_elm.submit();
                    });
                }
                else
                {
                    form_elm.addEventListener('submit', (e) => {
                        e.preventDefault();
                    });
                }
            }
        };

        function fnc_process_tl_submit(btn, form_id){

            sel_elm = document.getElementById("export_tl_section");
            form_elm = document.getElementById(form_id);

            if(sel_elm.value == '-1')
            {
                alert("Please select the export section!");
                form_elm.addEventListener('submit', (e) => {
                    e.preventDefault();
                });
            }
            else
            {
                val1 = document.getElementById("export_tl_section_1");

                val1.value = sel_elm.value;

                isConfirm = confirm('Confirm export topline for ' + sel_elm.options[sel_elm.selectedIndex].text + '?');

                if(isConfirm == true) {

                    form_elm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        form_elm.submit();
                    });

                }
                else
                {
                    form_elm.addEventListener('submit', (e) => {
                        e.preventDefault();
                    });
                }

            }

        };

        function fnc_tl_submit(btn, form_id, lbl){

            form_elm = document.getElementById(form_id);

            isConfirm = confirm('Confirm export ' + lbl + '?');

            if(isConfirm == true) {

                form_elm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    form_elm.submit();
                });

            }
            else
            {
                form_elm.addEventListener('submit', (e) => {
                    e.preventDefault();
                });
            }

        };

    </script>
{% endblock %}